
<!DOCTYPE html>
<html lang="en">
<head>
  
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>The Repository API | The Eclipse Foundation</title>
<meta property="og:title" content="The Repository API | The Eclipse Foundation" />
<meta name="twitter:title" content="The Repository API | The Eclipse Foundation" />
<meta name="description" content="The Repository API The Repository API is the central access point for rdf4j-compatible RDF databases (a.k.a. triplestores), as well as for SPARQL endpoints. Its purpose is to give a developer-friendly access point to RDF repositories, offering various methods for querying and updating the data, while hiding a lot of the nitty gritty details of the underlying machinery.
The interfaces for the Repository API can be found in package org.eclipse.rdf4j.repository. Several implementations for these interface exist in various sub-packages.">
<meta property="og:description" content="The Repository API The Repository API is the central access point for rdf4j-compatible RDF databases (a.k.a. triplestores), as well as for SPARQL endpoints. Its purpose is to give a developer-friendly access point to RDF repositories, offering various methods for querying and updating the data, while hiding a lot of the nitty gritty details of the underlying machinery.
The interfaces for the Repository API can be found in package org.eclipse.rdf4j.repository. Several implementations for these interface exist in various sub-packages.">
<meta name="twitter:description" content="The Repository API The Repository API is the central access point for rdf4j-compatible RDF databases (a.k.a. triplestores), as well as for SPARQL endpoints. Its purpose is to give a developer-friendly …">
<meta name="author" content="Christopher Guindon"/>
<link href='https://rdf4j.eclipse.org/images/favicon.png' rel='icon' type='image/x-icon'/>
<meta property="og:image" content="https://rdf4j.eclipse.org/images/rdf4j-logo-orange-114.png" />
<meta name="twitter:image" content="https://rdf4j.eclipse.org/images/rdf4j-logo-orange-114.png" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@EclipseFdn" />
<meta name="twitter:creator" content="@EclipseFdn" />
<meta property="og:url" content="https://rdf4j.eclipse.org/documentation/programming/repository/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Eclipse rdf4j" />
<meta name="keywords" content="hugo, solstice, eclipse foundatiou">


<meta name="generator" content="Hugo 0.40.1" />
<link rel="canonical" href="https://rdf4j.eclipse.org/documentation/programming/repository/" />
<link rel="alternate" href="https://rdf4j.eclipse.org/index.xml" type="application/rss+xml" title="Eclipse rdf4j">

<link rel="stylesheet" href="https://eclipse.org/eclipse.org-common/themes/solstice/public/stylesheets/quicksilver.min.css">
<link rel="stylesheet" href="/css/rdf4j.css">


  
<link href="//fonts.googleapis.com/css?family=Libre+Franklin:400,700,300,600,100" rel="stylesheet" type="text/css"/>

  
</head>
<body>
  
<a class="sr-only" href="#content">Skip to main content</a>
<header class="header-wrapper" id="header-wrapper">
  

<div class="clearfix toolbar-container-wrapper">
  <div class="container">
    <div class="text-right toolbar-row row hidden-print">
      <div class="col-md-24 row-toolbar-col">
        <ul class="list-inline">
          <li><a href="https://accounts.eclipse.org/user/edit" class="" data-tab-destination="tab-profile"><i class="fa fa-edit fa-fw"></i> Edit my account</a></li>
          <li><a class="toolbar-link toolbar-manage-cookies dropdown-toggle"><i class="fa fa-wrench"></i> Manage Cookies</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>
<div class="container">
  <div class="row" id="header-row">
    <div class="col-sm-5 col-md-4" id="header-left">
      <div class="wrapper-logo-default">
          <a title="Eclipse rdf4j" href="https://rdf4j.eclipse.org/">
            <img width="140" class="logo-eclipse-default img-responsive hidden-xs" src="https://rdf4j.eclipse.org/images/rdf4j-logo-orange-114.png" alt="Eclipse rdf4j" />
          </a>
        
      </div>
    </div>
    
    <div class="col-sm-19 col-md-20 reset margin-top-10" id="main-menu-wrapper">
    
      <div class="navbar yamm" id="main-menu">
        <div class="navbar-collapse collapse reset float-right" id="navbar-main-menu">
          <ul class="nav navbar-nav">
            



<li>
  <a class="" href="/news/">
  
  News
  </a>
  
</li>


<li class="dropdown">
  <a href="#" data-toggle="dropdown" class="dropdown-toggle">
    
    
    <span>About</span>
    <b class="caret"></b>
  </a>
  <ul class="dropdown-menu">
    
    <li><a href="/about/">Eclipse rdf4j</a> </li>
    
    <li><a href="/databases/">Rdf4j databases</a> </li>
    
    <li><a href="/related/">Related projects</a> </li>
    
  </ul>
  
</li>


<li>
  <a class="" href="/documentation/">
  
  Documentation
  </a>
  
</li>


<li>
  <a class="" href="/download/">
  
  Download
  </a>
  
</li>


<li>
  <a class="" href="/support/">
  
  Support
  </a>
  
</li>





          </ul>
        </div>
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-main-menu">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          </button>
          <div class="wrapper-logo-mobile">
            
              <a class="navbar-brand visible-xs" title="Eclipse rdf4j" href="https://rdf4j.eclipse.org/">
                <img width="140" class="logo-eclipse-default-mobile img-responsive" src="https://rdf4j.eclipse.org/images/rdf4j-logo-orange-114.png" alt="Eclipse rdf4j" />
              </a>
            
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  


</header>

  
<section class="default-breadcrumbs hidden-print" id="breadcrumb">
  <div class="container">
  <h3 class="sr-only">Breadcrumbs</h3>
  <div class="row">
    <div class="col-sm-24">
      <ol class="breadcrumb">
        
      
      
      
      
      
      
      
      <li>
        <a href="https://rdf4j.eclipse.org/">Eclipse rdf4j</a>
      </li>
      
      
      <li>
        <a href="https://rdf4j.eclipse.org/documentation/">Documentation</a>
      </li>
      
      
      <li>
        <a href="https://rdf4j.eclipse.org/documentation/programming/">Programming with rdf4j</a>
      </li>
      
      
      <li class="active">
        <a href="https://rdf4j.eclipse.org/documentation/programming/repository/">The Repository API</a>
      </li>
      
      </ol>
      
    </div>
  </div>
</section>

  
<main>
  <div class="container">
    
    <div class="row">
      <div class="col-md-18 padding-bottom-30">
        
        
        

<h1 id="the-repository-api">The Repository API</h1>

<p>The Repository API is the central access point for rdf4j-compatible RDF databases (a.k.a. triplestores), as well as for SPARQL endpoints. Its purpose is to give a developer-friendly access point to RDF repositories, offering various methods for querying and updating the data, while hiding a lot of the nitty gritty details of the underlying machinery.</p>

<p>The interfaces for the Repository API can be found in package org.eclipse.rdf4j.repository. Several implementations for these interface exist in various sub-packages.</p>

<h2 id="creating-a-repository-object">Creating a Repository object</h2>

<p>The first step in any action that involves repositories is to create a Repository for it.</p>

<p>The central interface of the repository API is the <code><a href='https://rdf4j.eclipse.org/javadoc/latest/org/eclipse/rdf4j/repository/Repository.html'>Repository</a></code>
 interface. There are several implementations available of this interface. The three main ones are:</p>

<p><code><a href='https://rdf4j.eclipse.org/javadoc/latest/org/eclipse/rdf4j/repository/sail/SailRepository.html'>SailRepository</a></code>
 is a Repository that operates directly on top of a <code><a href='https://rdf4j.eclipse.org/javadoc/latest/org/eclipse/rdf4j/sail/Sail.html'>Sail</a></code>
 - that is, a particular database. This is the class most commonly used when accessing/creating a local rdf4j repository. SailRepository operates on a (stack of) Sail object(s) for storage and retrieval of RDF data. An important thing to remember is that the behaviour of a repository is determined by the Sail(s) that it operates on; for example, the repository will only support RDF Schema or OWL semantics if the Sail stack includes an inferencer for this.</p>

<p><code><a href='https://rdf4j.eclipse.org/javadoc/latest/org/eclipse/rdf4j/repository/http/HTTPRepository.html'>HTTPRepository</a></code>
 is a Repository implementation that acts as a proxy to a repository available on a remote rdf4j Server, accessible through HTTP.</p>

<p><code><a href='https://rdf4j.eclipse.org/javadoc/latest/org/eclipse/rdf4j/repository/sparql/SPARQLRepository.html'>SPARQLRepository</a></code>
 is a Repository implementation that acts as a proxy to any remote SPARQL endpoint (whether that endpoint is implemented using rdf4j or not).</p>

<p>Creating Repository objects can be done in multiple ways. We will first show an easy way to quickly create such an object ‘on the fly’. In the section about the RepositoryManager and RepositoryProvider, we show some more advanced patterns, which are particularly useful in larger applications which have to handle and share references to multiple repositories.</p>

<p>We will first take a look at the use of the SailRepository class in order to create and use a local repository.</p>

<h3 id="creating-a-main-memory-rdf-repository">Creating a main memory RDF Repository</h3>

<p>One of the simplest configurations is a repository that just stores RDF data in main memory without applying any inferencing. This is also by far the fastest type of repository that can be used. The following code creates and initializes a non-inferencing main-memory repository:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.Repository</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.sail.SailRepository</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.sail.memory.MemoryStore</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">...</span>
Repository repo <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SailRepository<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> MemoryStore<span style="color:#000;font-weight:bold">());</span>
repo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">initialize</span><span style="color:#000;font-weight:bold">();</span></code></pre></td></tr></table>
</div>
</div>

<p>The constructor of the SailRepository class accepts any object of type Sail, so we simply pass it a new main-memory store object (which is, of course, a Sail implementation). Following this, the repository needs to be initialized to prepare the Sail(s) that it operates on.</p>

<p>The repository that is created by the above code is volatile: its contents are lost when the object is garbage collected or when your Java program is shut down. This is fine for cases where, for example, the repository is used as a means for manipulating an RDF model in memory.</p>

<p>Different types of Sail objects take parameters in their constructor that change their behaviour. The MemoryStore for example takes a data directory parameter that specifies a data directory for persisent storage. If specified, the MemoryStore will write its contents to this directory so that it can restore it when it is re-initialized in a future session:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">File dataDir <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> File<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;C:\\temp\\myRepository\\&#34;</span><span style="color:#000;font-weight:bold">);</span>
Repository repo <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SailRepository<span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">new</span> MemoryStore<span style="color:#000;font-weight:bold">(</span>dataDir<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">);</span>
repo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">initialize</span><span style="color:#000;font-weight:bold">();</span></code></pre></td></tr></table>
</div>
</div>

<p>As you can see, we can fine-tune the configuration of our repository by passing parameters to the constructor of the Sail object. Some Sail types may offer additional configuration methods, all of which need to be called before the repository is initialized. The MemoryStore currently has one such method: <code>setSyncDelay(long)</code>, which can be used to control the strategy that is used for writing to the data file, e.g.:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">File dataDir <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> File<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;C:\\temp\\myRepository\\&#34;</span><span style="color:#000;font-weight:bold">);</span>
MemoryStore memStore <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> MemoryStore<span style="color:#000;font-weight:bold">(</span>dataDir<span style="color:#000;font-weight:bold">);</span>
memStore<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setSyncDelay</span><span style="color:#000;font-weight:bold">(</span>1000L<span style="color:#000;font-weight:bold">);</span>
Repository repo <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SailRepository<span style="color:#000;font-weight:bold">(</span>memStore<span style="color:#000;font-weight:bold">);</span>
repo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">initialize</span><span style="color:#000;font-weight:bold">();</span></code></pre></td></tr></table>
</div>
</div>

<h3 id="creating-a-native-rdf-repository">Creating a Native RDF Repository</h3>

<p>A Native RDF Repository does not keep its data in main memory, but instead stores it directly to disk (in a binary format optimized for compact storage and fast retrieval). It is an efficient, scalable and fast solution for RDF storage of datasets that are too large to keep entirely in memory.</p>

<p>The code for creation of a Native RDF repository is almost identical to that of a main memory repository:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.Repository</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.sail.SailRepository</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.sail.nativerdf.NativeStore</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">...</span>
File dataDir <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> File<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/path/to/datadir/&#34;</span><span style="color:#000;font-weight:bold">);</span>
Repository repo <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SailRepository<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> NativeStore<span style="color:#000;font-weight:bold">(</span>dataDir<span style="color:#000;font-weight:bold">));</span>
repo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">initialize</span><span style="color:#000;font-weight:bold">();</span></code></pre></td></tr></table>
</div>
</div>

<p>By default, the Native store creates a set of two indexes. To configure which indexes it should create, we can either use the <code>NativeStore.setTripleIndexes(String)</code> method, or we can directly supply a index configuration string to the constructor:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.Repository</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.sail.SailRepository</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.sail.nativerdf.NativeStore</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">...</span>
File dataDir <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> File<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/path/to/datadir/&#34;</span><span style="color:#000;font-weight:bold">);</span>
String indexes <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;spoc,posc,cosp&#34;</span><span style="color:#000;font-weight:bold">;</span>
Repository repo <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SailRepository<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> NativeStore<span style="color:#000;font-weight:bold">(</span>dataDir<span style="color:#000;font-weight:bold">,</span> indexes<span style="color:#000;font-weight:bold">));</span>
repo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">initialize</span><span style="color:#000;font-weight:bold">();</span></code></pre></td></tr></table>
</div>
</div>

<h3 id="creating-a-repository-with-rdf-schema-inferencing">Creating a repository with RDF Schema inferencing</h3>

<p>As we have seen, we can create Repository objects for any kind of back-end store by passing them a reference to the appropriate Sail object. We can pass any stack of Sails this way, allowing all kinds of repository configurations to be created quite easily. For example, to stack an RDF Schema inferencer on top of a memory store, we simply create a repository like so:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.Repository</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.sail.SailRepository</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.sail.memory.MemoryStore</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.sail.inferencer.fc.SchemaCachingRDFSInferencer</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">...</span>
Repository repo <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SailRepository<span style="color:#000;font-weight:bold">(</span>
			  <span style="color:#000;font-weight:bold">new</span> SchemaCachingRDFSInferencer<span style="color:#000;font-weight:bold">(</span>
			  <span style="color:#000;font-weight:bold">new</span> MemoryStore<span style="color:#000;font-weight:bold">()));</span>
repo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">initialize</span><span style="color:#000;font-weight:bold">();</span></code></pre></td></tr></table>
</div>
</div>

<p>Each layer in the Sail stack is created by a constructor that takes the underlying Sail as a parameter. Finally, we create the SailRepository object as a functional wrapper around the Sail stack.</p>

<p>The <code><a href='https://rdf4j.eclipse.org/javadoc/latest/org/eclipse/rdf4j/sail/inferencer/fc/SchemaCachingInferencer.html'>SchemaCachingRDFSInferencer</a></code>
 that is used in this example is a generic RDF Schema inferencer; it can be used on top of any Sail that supports the methods it requires. Both MemoryStore and NativeStore support these methods. However, a word of warning: the rdf4j inferencers add a significant performance overhead when adding and removing data to a repository, an overhead that gets progressively worse as the total size of the repository increases. For small to medium-sized datasets it peforms fine, but for larger datasets you are advised not to use it and to switch to alternatives.</p>

<h3 id="creating-a-repository-with-a-custom-inferencing-rule">Creating a Repository with a Custom Inferencing Rule</h3>

<p>The previous subsection showed how to use the built-in RDF schema inferencer. This subsection will briefly show how to create a repository capable of performing inferences according to a custom rule that you provide.</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.query.QueryLanguage</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.Repository</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.sail.SailRepository</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.sail.memory.MemoryStore</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.sail.inferencer.fc.CustomGraphQueryInferencer</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">...</span>
String pre <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;PREFIX : &lt;http://foo.org/bar#&gt;\n&#34;</span><span style="color:#000;font-weight:bold">;</span>
String rule <span style="color:#000;font-weight:bold">=</span> pre <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;CONSTRUCT { ?p :relatesTo :Cryptography } WHERE &#34;</span> <span style="color:#000;font-weight:bold">+</span>
	      <span style="color:#d14">&#34;{ { :Bob ?p :Alice } UNION { :Alice ?p :Bob } }&#34;</span><span style="color:#000;font-weight:bold">;</span>
String match <span style="color:#000;font-weight:bold">=</span> pre <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;CONSTRUCT { ?p :relatesTo :Cryptography } &#34;</span> <span style="color:#000;font-weight:bold">+</span>
	       <span style="color:#d14">&#34;WHERE { ?p :relatesTo :Cryptography }&#34;</span><span style="color:#000;font-weight:bold">;</span>
Repository repo <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SailRepository<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> CustomGraphQueryInferencer<span style="color:#000;font-weight:bold">(</span>
		  <span style="color:#000;font-weight:bold">new</span> MemoryStore<span style="color:#000;font-weight:bold">(),</span> QueryLanguage<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">SPARQL</span><span style="color:#000;font-weight:bold">,</span> rule<span style="color:#000;font-weight:bold">,</span> match<span style="color:#000;font-weight:bold">));</span></code></pre></td></tr></table>
</div>
</div>

<p>Here is a data sample (given in the popular Turtle format) that serves to illustrate this example:</p>

<pre><code>@prefix : &lt;http://foo.org/bar#&gt; .
:Bob   :exchangesKeysWith :Alice .
:Alice :sendsMessageTo    :Bob .
</code></pre>

<p>If the above data is loaded into the repository, the repository will also automatically have the folliwng inferred statements:</p>

<pre><code>@prefix : &lt;http://foo.org/bar#&gt; .
:exchangesKeysWith :relatesTo :Cryptography .
:sendsMessageTo    :relatesTo :Cryptography .
</code></pre>

<p>The SPARQL graph query in ‘rule’ defines a pattern to search on, and the inferred statements to add to the repository.</p>

<p>The graph query in ‘match’ is needed to decide what inferred statements already exist that may need to be removed when the normal repository contents change. For example, if the first sample data statement was removed, then the inference layer will automatically remove the inferred statement regarding :exchangesKeysWith.</p>

<p>In simple rule cases, such as this one, an empty string could have been provided for ‘match’ instead, and the correct matcher query would have been deduced.</p>

<p>The CustomGraphQueryInferencer used here is useful, but fairly limited: it effectively only allows a single inference rule. For more complex custom inferencing or validation needs, you should look at the SPIN Sail or the SHACL Sail.</p>

<h3 id="accessing-a-server-side-repository">Accessing a server-side repository</h3>

<p>Working with remote repositories is just as easy as working with local ones. We can simply use a different Repository object, the HTTPRepository, instead of the SailRepository class.</p>

<p>A requirement is of course that there is a rdf4j Server running on some remote system, which is accessible over HTTP. For example, suppose that at <code>http://example.org/rdf4j-server/</code> a rdf4j Server is running, which has a repository with the identification ‘example-db’. We can access this repository in our code as follows:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.Repository</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.http.HTTPRepository</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">...</span>
String rdf4jServer <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;http://example.org/rdf4j-server/&#34;</span><span style="color:#000;font-weight:bold">;</span>
String repositoryID <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;example-db&#34;</span><span style="color:#000;font-weight:bold">;</span>
Repository repo <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HTTPRepository<span style="color:#000;font-weight:bold">(</span>rdf4jServer<span style="color:#000;font-weight:bold">,</span> repositoryID<span style="color:#000;font-weight:bold">);</span>
repo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">initialize</span><span style="color:#000;font-weight:bold">();</span></code></pre></td></tr></table>
</div>
</div>

<p>Note: some OpenJDK 8 JVMs have a ScheduledThreadPoolExecutor bug, causing high processor load even when idling. Setting the property <code>-Dorg.eclipse.rdf4j.client.executors.jdkbug</code> will use 1 core thread (instead of 0) for clients to remediate this.</p>

<h3 id="accessing-a-sparql-endpoint">Accessing a SPARQL endpoint</h3>

<p>We can use the Repository interface to access any SPARQL endpoint as well. This is done as follows:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.Repository</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.sparql.SPARQLRepository</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">...</span>
String sparqlEndpoint <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;http://example.org/sparql&#34;</span><span style="color:#000;font-weight:bold">;</span>
Repository repo <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SPARQLRepository<span style="color:#000;font-weight:bold">(</span>sparqlEndpoint<span style="color:#000;font-weight:bold">);</span>
repo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">initialize</span><span style="color:#000;font-weight:bold">();</span></code></pre></td></tr></table>
</div>
</div>

<p>After you have done this, you can query the SPARQL endpoint just as you would any other type of Repository.</p>

<h3 id="the-repositorymanager-and-repositoryprovider">The RepositoryManager and RepositoryProvider</h3>

<p>Using what we’ve seen in the previous section, we can easily create and use various different types of repositories. However, when developing an application in which you have to keep track of several repositories, sharing references to these repositories between different parts of your code can quickly become complex. Ideal would be one central location where all information on the repositories in use (including id, type, directory for persistent data storage, etc.) is kept. This is the role of the <code><a href='https://rdf4j.eclipse.org/javadoc/latest/org/eclipse/rdf4j/repository/manager/RepositoryManager.html'>RepositoryManager</a></code>
 and <code><a href='https://rdf4j.eclipse.org/javadoc/latest/org/eclipse/rdf4j/repository/manager/RepositoryProvider.html'>RepositoryProvider</a></code>
.</p>

<p>Using the RepositoryManager for handling repository creation and administration offers a number of advantages, including:</p>

<ul>
<li>a single RepositoryManager object can be more easily shared throughout your application than a host of static references to individual repositories;</li>
<li>you can more easily create and manage repositories ‘on-the-fly’, for example if your application requires creation of new repositories on user input;</li>
<li>the RepositoryManager stores your configuration, including all repository data, in one central spot on the file system.</li>
</ul>

<p>The RepositoryManager comes in two flavours: the LocalRepositoryManager and the RemoteRepositoryManager.</p>

<p>A LocalRepositoryManager manages repository handling for you locally, and is always created using a (local) directory. This directory is where all repositories handled by the manager store their data, and also where the LocalRepositoryManager itself stores its configuration data.</p>

<p>You create a new LocalRepositoryManager as follows:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.io.File</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.manager.LocalRepositoryManager</span><span style="color:#000;font-weight:bold">;</span>
File baseDir <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> File<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/path/to/storage/dir/&#34;</span><span style="color:#000;font-weight:bold">);</span>
LocalRepositoryManager manager <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> LocalRepositoryManager<span style="color:#000;font-weight:bold">(</span>baseDir<span style="color:#000;font-weight:bold">);</span>
manager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">initialize</span><span style="color:#000;font-weight:bold">();</span></code></pre></td></tr></table>
</div>
</div>

<p>To use a LocalRepositoryManager to create and manage repositories is slightly different from what we’ve seen before about creating repositories. The LocalRepositoryManager works by providing it with <code><a href='https://rdf4j.eclipse.org/javadoc/latest/org/eclipse/rdf4j/repository/config/RepositoryConfig.html'>RepositoryConfig</a></code>
 objects, which are declarative specifications of the repository you want. You add a RepositoryConfig object for your new repository, and then request the actual Repository back from the LocalRepositoryManager:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.config.RepositoryConfig</span><span style="color:#000;font-weight:bold">;</span>

String repositoryId <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;test-db&#34;</span><span style="color:#000;font-weight:bold">;</span>
RepositoryConfig repConfig <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> RepositoryConfig<span style="color:#000;font-weight:bold">(</span>repositoryId<span style="color:#000;font-weight:bold">,</span> repositoryTypeSpec<span style="color:#000;font-weight:bold">);</span>
manager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addRepositoryConfig</span><span style="color:#000;font-weight:bold">(</span>repConfig<span style="color:#000;font-weight:bold">);</span>

Repository repository <span style="color:#000;font-weight:bold">=</span> manager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getRepository</span><span style="color:#000;font-weight:bold">(</span>repositoryId<span style="color:#000;font-weight:bold">);</span></code></pre></td></tr></table>
</div>
</div>

<p>In the above bit of code, you may have noticed that we provide an innocuous-looking variable called repositoryTypeSpec to the constructor of our RepositoryConfig. This variable is an instance of a class called <code>RepositoryImplConfig</code>, and this specifies the actual configuration of our new repository: what backends to use, whether or not to use inferencing, and so on.</p>

<p>Creating a RepositoryImplConfig object can be done in two ways: programmatically, or by reading a (RDF) config file. Here, we will show the programmatic way.</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.sail.config.SailImplConfig</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.sail.memory.config.MemoryStoreConfig</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.config.RepositoryImplConfig</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.sail.config.SailRepositoryConfig</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#998;font-style:italic">// create a configuration for the SAIL stack
</span><span style="color:#998;font-style:italic"></span>SailImplConfig backendConfig <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> MemoryStoreConfig<span style="color:#000;font-weight:bold">();</span>

<span style="color:#998;font-style:italic">// create a configuration for the repository implementation
</span><span style="color:#998;font-style:italic"></span>RepositoryImplConfig repositoryTypeSpec <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SailRepositoryConfig<span style="color:#000;font-weight:bold">(</span>backendConfig<span style="color:#000;font-weight:bold">);</span></code></pre></td></tr></table>
</div>
</div>

<p>As you can see, we use a class called <code>MemoryStoreConfig</code> for specifying the type of storage backend we want. This class resides in a config sub-package of the memory store package (<code>org.eclipse.rdf4j.sail.memory.config</code>). Each particular type of SAIL in rdf4j has such a config class.</p>

<p>As a second example, we create a slightly more complex type of store: still in-memory, but this time we want it to use the memory store’s persistence option, and we also want to add RDFS inferencing. In rdf4j, RDFS inferencing is provided by a separate SAIL implementation, which can be ‘stacked’ on top of another SAIL. We follow that pattern in the creation of our config object:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.sail.inferencer.fc.config.SchemaCachingRDFSInferencerConfig</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#998;font-style:italic">// create a configuration for the SAIL stack
</span><span style="color:#998;font-style:italic"></span><span style="color:#458;font-weight:bold">boolean</span> persist <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
SailImplConfig backendConfig <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> MemoryStoreConfig<span style="color:#000;font-weight:bold">(</span>persist<span style="color:#000;font-weight:bold">);</span>

<span style="color:#998;font-style:italic">// stack an inferencer config on top of our backend-config
</span><span style="color:#998;font-style:italic"></span>backendConfig <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SchemaCachingRDFSInferencerConfig<span style="color:#000;font-weight:bold">(</span>backendConfig<span style="color:#000;font-weight:bold">);</span>

<span style="color:#998;font-style:italic">// create a configuration for the repository implementation
</span><span style="color:#998;font-style:italic"></span>SailRepositoryConfig repositoryTypeSpec <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SailRepositoryConfig<span style="color:#000;font-weight:bold">(</span>backendConfig<span style="color:#000;font-weight:bold">);</span></code></pre></td></tr></table>
</div>
</div>

<h3 id="the-remoterepositorymanager">The RemoteRepositoryManager</h3>

<p>A useful feature of rdf4j is that most its APIs are transparent with respect to whether you are working locally or remote. This is the case for the rdf4j repositories, but also for the RepositoryManager. In the above examples, we have used a LocalRepositoryManager, creating repositories for local use. However, it is also possible to use a RemoteRepositoryManager, using it to create and manage repositories residing on a remotely running rdf4j Server.</p>

<p>A RemoteRepositoryManager is initialized as follows:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.manager.RemoteRepositoryManager</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#998;font-style:italic">// URL of the remote rdf4j Server we want to access
</span><span style="color:#998;font-style:italic"></span>String serverUrl <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;http://localhost:8080/rdf4j-server&#34;</span><span style="color:#000;font-weight:bold">;</span>
RemoteRepositoryManager manager <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> RemoteRepositoryManager<span style="color:#000;font-weight:bold">(</span>serverUrl<span style="color:#000;font-weight:bold">);</span>
manager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">initialize</span><span style="color:#000;font-weight:bold">();</span></code></pre></td></tr></table>
</div>
</div>

<p>Once initialized, the RemoteRepositoryManager can be used in the same fashion as the LocalRepositoryManager: creating new repositories, requesting references to existing repositories, and so on.</p>

<h3 id="sharing-managers-with-the-repositoryprovider">Sharing Managers with the RepositoryProvider</h3>

<p>Finally, rdf4j also includes a RepositoryProvider class. This is a utility class that holds static references to RepositoryManagers, making it easy to share Managers (and the repositories they contain) across your application. In addition, the RepositoryProvider also has a built-in shutdown hook, which makes sure all repositories managed by it are shut down when the JVM exits.</p>

<p>To obtain a RepositoryManager from a RepositoryProvider you invoke it with the location you want a RepositoryManager for. If you provide a HTTP url, it will automatically return a RemoteRepositoryManager, and if you provide a local file URL, it will be a LocalRepositoryManager.</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.manager.RepositoryProvider</span><span style="color:#000;font-weight:bold">;</span>
String url <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;http://localhost:8080/rdf4j-server&#34;</span><span style="color:#000;font-weight:bold">;</span>
RepositoryManager manager  <span style="color:#000;font-weight:bold">=</span> RepositoryProvider<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getRepositoryManager</span><span style="color:#000;font-weight:bold">(</span>url<span style="color:#000;font-weight:bold">);</span></code></pre></td></tr></table>
</div>
</div>

<p>The RepositoryProvider creates and keeps a singleton instance of RepositoryManager for each distinct location you specify, which means that you invoke the above call in several places in your code without having to worry about creating duplicate manager objects.</p>

<h3 id="creating-a-federation">Creating a Federation</h3>

<p>It is possible to create a virtual repository that is a federation of existing repositories. The following code illustrates how to use the RepositoryManagerFederator class to create a federation. It assumes you already have a reference to a RepositoryManager instance, and is a simplified form of what the rdf4j Console runs when its federate command is invoked:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">federate</span><span style="color:#000;font-weight:bold">(</span>RepositoryManager manager<span style="color:#000;font-weight:bold">,</span> String fedID<span style="color:#000;font-weight:bold">,</span> String description<span style="color:#000;font-weight:bold">,</span>
	Collection<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;</span> memberIDs<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">boolean</span> readonly<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">boolean</span> distinct<span style="color:#000;font-weight:bold">)</span>
	<span style="color:#000;font-weight:bold">throws</span> MalformedURLException<span style="color:#000;font-weight:bold">,</span> rdf4jException <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>manager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">hasRepositoryConfig</span><span style="color:#000;font-weight:bold">(</span>fedID<span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span>
	System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">err</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>fedID <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34; already exists.&#34;</span><span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>validateMembers<span style="color:#000;font-weight:bold">(</span>manager<span style="color:#000;font-weight:bold">,</span> readonly<span style="color:#000;font-weight:bold">,</span> memberIDs<span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span>
	RepositoryManagerFederator rmf <span style="color:#000;font-weight:bold">=</span>
	    <span style="color:#000;font-weight:bold">new</span> RepositoryManagerFederator<span style="color:#000;font-weight:bold">(</span>manager<span style="color:#000;font-weight:bold">);</span>
	rmf<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addFed</span><span style="color:#000;font-weight:bold">(</span>fedID<span style="color:#000;font-weight:bold">,</span> description<span style="color:#000;font-weight:bold">,</span> memberIDs<span style="color:#000;font-weight:bold">,</span> readonly<span style="color:#000;font-weight:bold">,</span> distinct<span style="color:#000;font-weight:bold">);</span>
	System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">writeln</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Federation created.&#34;</span><span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">validateMembers</span><span style="color:#000;font-weight:bold">(</span>RepositoryManager manager<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">boolean</span> readonly<span style="color:#000;font-weight:bold">,</span>
	 Collection<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;</span> memberIDs<span style="color:#000;font-weight:bold">)</span>
	 <span style="color:#000;font-weight:bold">throws</span> rdf4jException <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#458;font-weight:bold">boolean</span> result <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>String memberID <span style="color:#000;font-weight:bold">:</span> memberIDs<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>manager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">hasRepositoryConfig</span><span style="color:#000;font-weight:bold">(</span>memberID<span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span>
	    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(!</span>readonly<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(!</span>manager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getRepository</span><span style="color:#000;font-weight:bold">(</span>memberID<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">isWritable</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
		    result <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
		    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">err</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>memberID <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34; is read-only.&#34;</span><span style="color:#000;font-weight:bold">);</span>
		<span style="color:#000;font-weight:bold">}</span>
	    <span style="color:#000;font-weight:bold">}</span>
	<span style="color:#000;font-weight:bold">}</span>
	<span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
	   result <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
	   System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">err</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>memberID <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34; does not exist.&#34;</span><span style="color:#000;font-weight:bold">);</span>
	<span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">return</span> result<span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<h2 id="using-a-repository-repositoryconnections">Using a repository: RepositoryConnections</h2>

<p>Now that we have created a Repository, we want to do something with it. In rdf4j, this is achieved through the use of RepositoryConnection objects, which can be created by the Repository.</p>

<p>A <code><a href='https://rdf4j.eclipse.org/javadoc/latest/org/eclipse/rdf4j/repository/RepositoryConnection.html'>RepositoryConnection</a></code>
 represents – as the name suggests – a connection to the actual store. We can issue operations over this connection, and close it when we are done to make sure we are not keeping resources unnnecessarily occupied.</p>

<p>In the following sections, we will show some examples of basic operations.</p>

<h3 id="adding-rdf-to-a-repository">Adding RDF to a repository</h3>

<p>The Repository API offers various methods for adding data to a repository. Data can be added by specifying the location of a file that contains RDF data, and statements can be added individually or in collections.</p>

<p>We perform operations on a repository by requesting a <code>RepositoryConnection</code> from the repository. On this RepositoryConnection object we can perform various operations, such as query evaluation, getting, adding, or removing statements, etc.</p>

<p>The following example code adds two files, one local and one available through HTTP, to a repository:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.rdf4jException</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.Repository</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.RepositoryConnection</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.rio.RDFFormat</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.io.File</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.net.URL</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">...</span>
File file <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> File<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/path/to/example.rdf&#34;</span><span style="color:#000;font-weight:bold">);</span>
String baseURI <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;http://example.org/example/local&#34;</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
   RepositoryConnection con <span style="color:#000;font-weight:bold">=</span> repo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">();</span>
   <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
      con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>file<span style="color:#000;font-weight:bold">,</span> baseURI<span style="color:#000;font-weight:bold">,</span> RDFFormat<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">RDFXML</span><span style="color:#000;font-weight:bold">);</span>
      URL url <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> URL<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;http://example.org/example/remote.rdf&#34;</span><span style="color:#000;font-weight:bold">);</span>
      con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>url<span style="color:#000;font-weight:bold">,</span> url<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toString</span><span style="color:#000;font-weight:bold">(),</span> RDFFormat<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">RDFXML</span><span style="color:#000;font-weight:bold">);</span>
   <span style="color:#000;font-weight:bold">}</span>
   <span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
      con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">();</span>
   <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>rdf4jException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
   <span style="color:#998;font-style:italic">// handle exception
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>java<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">io</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">IOEXception</span> e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
   <span style="color:#998;font-style:italic">// handle io exception
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>As you can see, the above code does very explicit exception handling and makes sure resources are properly closed when we are done. A lot of this can be simplified. <code>RepositoryConnection</code> implements <code>AutoCloseable</code>, so a first simple change is to use a try-with-resources construction for handling proper opening and closing of the <code>RepositoryConnection</code>:</p>

<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">File file <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> File<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/path/to/example.rdf&#34;</span><span style="color:#000;font-weight:bold">);</span>
String baseURI <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;http://example.org/example/local&#34;</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">(</span>RepositoryConnection con <span style="color:#000;font-weight:bold">=</span> repo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
   con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>file<span style="color:#000;font-weight:bold">,</span> baseURI<span style="color:#000;font-weight:bold">,</span> RDFFormat<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">RDFXML</span><span style="color:#000;font-weight:bold">);</span>
   URL url <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> URL<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;http://example.org/example/remote.rdf&#34;</span><span style="color:#000;font-weight:bold">);</span>
   con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>url<span style="color:#000;font-weight:bold">,</span> url<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toString</span><span style="color:#000;font-weight:bold">(),</span> RDFFormat<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">RDFXML</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>rdf4jException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
   <span style="color:#998;font-style:italic">// handle exception. This catch-clause is
</span><span style="color:#998;font-style:italic"></span>   <span style="color:#998;font-style:italic">// optional since rdf4jException is an unchecked exception
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>java<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">io</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">IOEXception</span> e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
   <span style="color:#998;font-style:italic">// handle io exception
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span></code></pre></div>

<p>More information on other available methods can be found in the <code><a href='https://rdf4j.eclipse.org/javadoc/latest/org/eclipse/rdf4j/repository/RepositoryConnection.html'>RepositoryConnection</a></code>
 javadoc.</p>

<h3 id="querying-a-repository">Querying a repository</h3>

<p>The Repository API has a number of methods for creating and evaluating queries. Three types of queries are distinguished: tuple queries, graph queries and boolean queries. The query types differ in the type of results that they produce.</p>

<p>The result of a tuple query is a set of tuples (or variable bindings), where each tuple represents a solution of a query. This type of query is commonly used to get specific values (URIs, blank nodes, literals) from the stored RDF data. SPARQL SELECT queries are tuple queries.</p>

<p>The result of graph queries is an RDF graph (or set of statements). This type of query is very useful for extracting sub-graphs from the stored RDF data, which can then be queried further, serialized to an RDF document, etc. SPARQL CONSTRUCT and DESCRIBE queries are graph queries.</p>

<p>The result of boolean queries is a simple boolean value, i.e. true or false. This type of query can be used to check if a repository contains specific information. SPARQL ASK queries are boolean queries.</p>

<h4 id="select-tuple-queries">SELECT: tuple queries</h4>

<p>To evaluate a (SELECT) tuple query we can do the following:</p>

<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.List</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.rdf4jException</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.repository.RepositoryConnection</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.query.TupleQuery</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.query.TupleQueryResult</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.query.BindingSet</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.query.QueryLanguage</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">...</span>
<span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">(</span>RepositoryConnection conn <span style="color:#000;font-weight:bold">=</span> repo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
   String queryString <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;SELECT ?x ?y WHERE { ?x ?p ?y } &#34;</span><span style="color:#000;font-weight:bold">;</span>
   TupleQuery tupleQuery <span style="color:#000;font-weight:bold">=</span> con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">prepareTupleQuery</span><span style="color:#000;font-weight:bold">(</span>QueryLanguage<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">SPARQL</span><span style="color:#000;font-weight:bold">,</span> queryString<span style="color:#000;font-weight:bold">);</span>
   <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">(</span>TupleQueryResult result <span style="color:#000;font-weight:bold">=</span> tupleQuery<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">evaluate</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">(</span>result<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">hasNext</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>  <span style="color:#998;font-style:italic">// iterate over the result
</span><span style="color:#998;font-style:italic"></span>         BindingSet bindingSet <span style="color:#000;font-weight:bold">=</span> result<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">next</span><span style="color:#000;font-weight:bold">();</span>
         Value valueOfX <span style="color:#000;font-weight:bold">=</span> bindingSet<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;x&#34;</span><span style="color:#000;font-weight:bold">);</span>
         Value valueOfY <span style="color:#000;font-weight:bold">=</span> bindingSet<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;y&#34;</span><span style="color:#000;font-weight:bold">);</span>
         <span style="color:#998;font-style:italic">// do something interesting with the values here...
</span><span style="color:#998;font-style:italic"></span>      <span style="color:#000;font-weight:bold">}</span>
   <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></div>

<p>This evaluates a SPARQL SELECT query and returns a TupleQueryResult, which consists of a sequence of BindingSet objects. Each BindingSet contains a set of Binding objects. A binding is pair relating a variable name (as used in the query’s SELECT clause) with a value.</p>

<p>As you can see, we use the TupleQueryResult to iterate over all results and get each individual result for x and y. We retrieve values by name rather than by an index. The names used should be the names of variables as specified in your query (note that we leave out the ‘?’ or ‘$’ prefixes used in SPARQL). The TupleQueryResult.getBindingNames() method returns a list of binding names, in the order in which they were specified in the query. To process the bindings in each binding set in the order specified by the projection, you can do the following:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">List<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;</span> bindingNames <span style="color:#000;font-weight:bold">=</span> result<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getBindingNames</span><span style="color:#000;font-weight:bold">();</span>
<span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">(</span>result<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">hasNext</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
   BindingSet bindingSet <span style="color:#000;font-weight:bold">=</span> result<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">next</span><span style="color:#000;font-weight:bold">();</span>
   Value firstValue <span style="color:#000;font-weight:bold">=</span> bindingSet<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">(</span>bindingNames<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>0<span style="color:#000;font-weight:bold">));</span>
   Value secondValue <span style="color:#000;font-weight:bold">=</span> bindingSet<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">(</span>bindingNames<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">));</span>
   <span style="color:#998;font-style:italic">// do something interesting with the values here...
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>Finally, it is important to make sure that both the TupleQueryResult and the RepositoryConnection are properly closed after we are done with them. A TupleQueryResult evaluates lazily and keeps resources (such as connections to the underlying database) open. Closing the TupleQueryResult frees up these resources. You can either expliclty invoke close() in the finally clause, or use a try-with-resources construction (as shown in the above examples) to let Java itself handle proper closing for you. In the following code examples, we will use both ways to handle both result and connection closure interchangeably.</p>

<p>As said: a TupleQueryResult evaluates lazily, and keeps an open connection to the data source while being processed. If you wish to quickly materialize the full query result (for example, convert it to a Java List) and then close the TupleQueryResult, you can do something like this:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">List<span style="color:#000;font-weight:bold">&lt;</span>BindingSet<span style="color:#000;font-weight:bold">&gt;</span> resultList<span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">(</span>TupleQueryResult result <span style="color:#000;font-weight:bold">=</span> tupleQuery<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">evaluate</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
   resultList <span style="color:#000;font-weight:bold">=</span> QueryResults<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">asList</span><span style="color:#000;font-weight:bold">(</span>result<span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<h4 id="a-tuple-query-in-a-single-line-of-code-the-repositories-utility">A tuple query in a single line of code: the Repositories utility</h4>

<p>rdf4j provides a convenience utility class org.eclipse.rdf4j.repository.util.Repositories, which allows us to significantly shorten our boilerplate code. In particular, the Repositories utility allows us to do away with opening/closing a RepositoryConnection completely. For example, to open a connection, create and evaluate a SPARQL SELECT query, and then put that query’s result in a list, we can do the following:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">List<span style="color:#000;font-weight:bold">&lt;</span>BindingSet<span style="color:#000;font-weight:bold">&gt;</span> results <span style="color:#000;font-weight:bold">=</span> Repositories<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">tupleQuery</span><span style="color:#000;font-weight:bold">(</span>rep<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;SELECT * WHERE {?s ?p ?o }&#34;</span><span style="color:#000;font-weight:bold">,</span> r <span style="color:#000;font-weight:bold">-&gt;</span> QueryResults<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">asList</span><span style="color:#000;font-weight:bold">(</span>r<span style="color:#000;font-weight:bold">));</span></code></pre></td></tr></table>
</div>
</div>

<p>As you can see, we make use of so-called Lambda expressions to process the result. In this particular example, the only processing we do is to convert the TupleQueryResult object into a List. However, you can supply any kind of function to this interface to fully customize the processing that you do on the result.</p>

<h4 id="using-tuplequeryresulthandlers">Using TupleQueryResultHandlers</h4>

<p>You can also directly process the query result by supplying a TupleQueryResultHandler to the query’s evaluate() method. The main difference is that when using a return object, the caller has control over when the next answer is retrieved (namely, whenever next() is called), whereas with the use of a handler, the connection pushes answers to the handler object as soon as it has them available.</p>

<p>As an example we will use SPARQLResultsCSVWriter to directly write the query result to the console. SPARQLResultsCSVWriter is a TupleQueryResultHandler implementation that writes SPARQL Results as comma-separated values.</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">String queryString <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;SELECT * WHERE {?x ?p ?y }&#34;</span><span style="color:#000;font-weight:bold">;</span>
con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">prepareTupleQuery</span><span style="color:#000;font-weight:bold">(</span>queryString<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">evaluate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> SPARQLResultsCSVWriter<span style="color:#000;font-weight:bold">(</span>System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">));</span></code></pre></td></tr></table>
</div>
</div>

<p>rdf4j provides a number of standard implementations of TupleQueryResultHandler, and of course you can also supply your own application-specific implementation. Have a look in the Javadoc for more details.</p>

<h4 id="construct-describe-graph-queries">CONSTRUCT/DESCRIBE: graph queries</h4>

<p>The following code evaluates a graph query on a repository:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.query.GraphQueryResult</span><span style="color:#000;font-weight:bold">;</span>
GraphQueryResult graphResult <span style="color:#000;font-weight:bold">=</span> con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">prepareGraphQuery</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;CONSTRUCT { ?s ?p ?o } WHERE {?s ?p ?o }&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">evaluate</span><span style="color:#000;font-weight:bold">();</span></code></pre></td></tr></table>
</div>
</div>

<p>A GraphQueryResult is similar to TupleQueryResult in that is an object that iterates over the query solutions. However, for graph queries the query solutions are RDF statements, so a GraphQueryResult iterates over Statement objects:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">(</span>graphResult<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">hasNext</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
   Statement st <span style="color:#000;font-weight:bold">=</span> graphResult<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">next</span><span style="color:#000;font-weight:bold">();</span>
   <span style="color:#998;font-style:italic">// ... do something with the resulting statement here.
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>You can also quickly turn a GraphQueryResult into a Model (that is, a Java Collection of statements), by using the org.eclipse.rdf4j.query.QueryResults utility class:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Model resultModel <span style="color:#000;font-weight:bold">=</span> QueryResults<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">asModel</span><span style="color:#000;font-weight:bold">(</span>graphQueryResult<span style="color:#000;font-weight:bold">);</span></code></pre></td></tr></table>
</div>
</div>

<h4 id="doing-a-graph-query-in-a-single-line-of-code">Doing a graph query in a single line of code</h4>

<p>Similarly to how we do this with SELECT queries, we can use the Repositories utility to obtain a result from a SPARQL CONSTRUCT (or DESCRIBE) query in a single line of Java code:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Model m <span style="color:#000;font-weight:bold">=</span> Repositories<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">graphQuery</span><span style="color:#000;font-weight:bold">(</span>rep<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;CONSTRUCT WHERE {?s ?p ?o}&#34;</span><span style="color:#000;font-weight:bold">,</span> r <span style="color:#000;font-weight:bold">-&gt;</span> QueryResults<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">asModel</span><span style="color:#000;font-weight:bold">(</span>r<span style="color:#000;font-weight:bold">));</span></code></pre></td></tr></table>
</div>
</div>

<h4 id="using-rdfhandlers">Using RDFHandlers</h4>

<p>For graph queries, we can supply an org.eclipse.rdf4j.rio.RDFHandler to the evaluate() method. Again, this is a generic interface, each object implementing it can process the reported RDF statements in any way it wants.</p>

<p>All Rio writers (such as the RDFXmlWriter, TurtleWriter, TriXWriter, etc.) implement the RDFHandler interface. This allows them to be used in combination with querying quite easily. In the following example, we use a TurtleWriter to write the result of a SPARQL graph query to standard output in Turtle format:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.rio.Rio</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.rio.RDFFormat</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.rio.RDFWriter</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">(</span>RepositoryConnection conn <span style="color:#000;font-weight:bold">=</span> repo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
   RDFWriter writer <span style="color:#000;font-weight:bold">=</span> Rio<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createWriter</span><span style="color:#000;font-weight:bold">(</span>RDFFormat<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TURTLE</span><span style="color:#000;font-weight:bold">,</span> System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">);</span>
   conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">prepareGraphQuery</span><span style="color:#000;font-weight:bold">(</span>QueryLanguage<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">SPARQL</span><span style="color:#000;font-weight:bold">,</span>
       <span style="color:#d14">&#34;CONSTRUCT {?s ?p ?o } WHERE {?s ?p ?o } &#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">evaluate</span><span style="color:#000;font-weight:bold">(</span>writer<span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>Note that in the above code we use the org.eclipse.rdf4j.rio.Rio utility to quickly create a writer of the desired format. The Rio utility offers a lot of useful functions to quickly create writers and parser for various formats.</p>

<h4 id="preparing-and-reusing-queries">Preparing and Reusing Queries</h4>

<p>In the previous sections we have simply created a query from a string and immediately evaluated it. However, the prepareTupleQuery and prepareGraphQuery methods return objects of type Query, specifically TupleQuery and GraphQuery.</p>

<p>A Query object, once created, can be reused several times. For example, we can evaluate a Query object, then add some data to our repository, and evaluate the same query again.</p>

<p>The Query object also has a setBinding() method, which can be used to specify specific values for query variables. As a simple example, suppose we have a repository containing names and e-mail addresses of people, and we want to do a query for each person, retrieve his/her e-mail address, for example, but we want to do a separate query for each person. This can be achieved using the setBinding() functionality, as follows:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">(</span>RepositoryConnection con <span style="color:#000;font-weight:bold">=</span> repo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">()){</span>
   <span style="color:#998;font-style:italic">// First, prepare a query that retrieves all names of persons
</span><span style="color:#998;font-style:italic"></span>   TupleQuery nameQuery <span style="color:#000;font-weight:bold">=</span> con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">prepareTupleQuery</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SELECT ?name WHERE { ?person ex:name ?name . }&#34;</span><span style="color:#000;font-weight:bold">);</span>

   <span style="color:#998;font-style:italic">// Then, prepare another query that retrieves all e-mail addresses of persons:
</span><span style="color:#998;font-style:italic"></span>   TupleQuery mailQuery <span style="color:#000;font-weight:bold">=</span> con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">prepareTupleQuery</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SELECT ?mail WHERE { ?person ex:mail ?mail ; ex:name ?name . }&#34;</span><span style="color:#000;font-weight:bold">);</span>

   <span style="color:#998;font-style:italic">// Evaluate the first query to get all names
</span><span style="color:#998;font-style:italic"></span>   <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">(</span>TupleQueryResult nameResult <span style="color:#000;font-weight:bold">=</span> nameQuery<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">evaluate</span><span style="color:#000;font-weight:bold">()){</span>
      <span style="color:#998;font-style:italic">// Loop over all names, and retrieve the corresponding e-mail address.
</span><span style="color:#998;font-style:italic"></span>      <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">(</span>nameResult<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">hasNext</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
	 BindingSet bindingSet <span style="color:#000;font-weight:bold">=</span> nameResult<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">next</span><span style="color:#000;font-weight:bold">();</span>
	 Value name <span style="color:#000;font-weight:bold">=</span> bindingSet<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;name&#34;</span><span style="color:#000;font-weight:bold">);</span>

	 <span style="color:#998;font-style:italic">// Retrieve the matching mailbox, by setting the binding for
</span><span style="color:#998;font-style:italic"></span>	 <span style="color:#998;font-style:italic">// the variable &#39;name&#39; to the retrieved value. Note that we
</span><span style="color:#998;font-style:italic"></span>	 <span style="color:#998;font-style:italic">// can set the same binding name again for each iteration, it will
</span><span style="color:#998;font-style:italic"></span>	 <span style="color:#998;font-style:italic">// overwrite the previous setting.
</span><span style="color:#998;font-style:italic"></span>	 mailQuery<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setBinding</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;name&#34;</span><span style="color:#000;font-weight:bold">,</span> name<span style="color:#000;font-weight:bold">);</span>
	 <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">(</span> TupleQueryResult mailResult <span style="color:#000;font-weight:bold">=</span> mailQuery<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">evaluate</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
	    <span style="color:#998;font-style:italic">// mailResult now contains the e-mail addresses for one particular person
</span><span style="color:#998;font-style:italic"></span>
	    <span style="color:#000;font-weight:bold">....</span>
	 <span style="color:#000;font-weight:bold">}</span>
      <span style="color:#000;font-weight:bold">}</span>
   <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>The values with which you perform the setBinding operation of course do not necessarily have to come from a previous query result (as they do in the above example). Using a ValueFactory you can create your own value objects. You can use this functionality to, for example, query for a particular keyword that is given by user input:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">ValueFactory factory <span style="color:#000;font-weight:bold">=</span> myRepository<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValueFactory</span><span style="color:#000;font-weight:bold">();</span>

<span style="color:#998;font-style:italic">// In this example, we specify the keyword string. Of course, this
</span><span style="color:#998;font-style:italic">// could just as easily be obtained by user input, or by reading from
</span><span style="color:#998;font-style:italic">// a file, or...
</span><span style="color:#998;font-style:italic"></span>String keyword <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;foobar&#34;</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#998;font-style:italic">// We prepare a query that retrieves all documents for a keyword.
</span><span style="color:#998;font-style:italic">// Notice that in this query the &#39;keyword&#39; variable is not bound to
</span><span style="color:#998;font-style:italic">// any specific value yet.
</span><span style="color:#998;font-style:italic"></span>TupleQuery keywordQuery <span style="color:#000;font-weight:bold">=</span> con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">prepareTupleQuery</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SELECT ?document WHERE { ?document ex:keyword ?keyword . }&#34;</span><span style="color:#000;font-weight:bold">);</span>

<span style="color:#998;font-style:italic">// Then we set the binding to a literal representation of our keyword.
</span><span style="color:#998;font-style:italic">// Evaluation of the query object will now effectively be the same as
</span><span style="color:#998;font-style:italic">// if we had specified the query as follows:
</span><span style="color:#998;font-style:italic">//   SELECT ?document WHERE { ?document ex:keyword &#34;foobar&#34;. }
</span><span style="color:#998;font-style:italic"></span>keywordQuery<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setBinding</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;keyword&#34;</span><span style="color:#000;font-weight:bold">,</span> factory<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createLiteral</span><span style="color:#000;font-weight:bold">(</span>keyword<span style="color:#000;font-weight:bold">));</span>

<span style="color:#998;font-style:italic">// We then evaluate the prepared query and can process the result:
</span><span style="color:#998;font-style:italic"></span>TupleQueryResult keywordQueryResult <span style="color:#000;font-weight:bold">=</span> keywordQuery<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">evaluate</span><span style="color:#000;font-weight:bold">();</span></code></pre></td></tr></table>
</div>
</div>

<h3 id="creating-retrieving-removing-individual-statements">Creating, retrieving, removing individual statements</h3>

<p>The RepositoryConnection can also be used for adding, retrieving, removing or otherwise manipulating individual statements, or sets of statements.</p>

<p>To be able to add new statements, we can use a ValueFactory to create the Values out of which the statements consist. For example, we want to add a few statements about two resources, Alice and Bob:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.model.vocabulary.RDF</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.model.vocabulary.RDFS</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">...</span>

ValueFactory f <span style="color:#000;font-weight:bold">=</span> myRepository<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValueFactory</span><span style="color:#000;font-weight:bold">();</span>

<span style="color:#998;font-style:italic">// create some resources and literals to make statements out of
</span><span style="color:#998;font-style:italic"></span>IRI alice <span style="color:#000;font-weight:bold">=</span> f<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createIRI</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;http://example.org/people/alice&#34;</span><span style="color:#000;font-weight:bold">);</span>
IRI bob <span style="color:#000;font-weight:bold">=</span> f<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createIRI</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;http://example.org/people/bob&#34;</span><span style="color:#000;font-weight:bold">);</span>
IRI name <span style="color:#000;font-weight:bold">=</span> f<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createIRI</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;http://example.org/ontology/name&#34;</span><span style="color:#000;font-weight:bold">);</span>
IRI person <span style="color:#000;font-weight:bold">=</span> f<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createIRI</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;http://example.org/ontology/Person&#34;</span><span style="color:#000;font-weight:bold">);</span>
Literal bobsName <span style="color:#000;font-weight:bold">=</span> f<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createLiteral</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Bob&#34;</span><span style="color:#000;font-weight:bold">);</span>
Literal alicesName <span style="color:#000;font-weight:bold">=</span> f<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createLiteral</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Alice&#34;</span><span style="color:#000;font-weight:bold">);</span>

<span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">(</span> RepositoryConnection con <span style="color:#000;font-weight:bold">=</span> myRepository<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#998;font-style:italic">// alice is a person
</span><span style="color:#998;font-style:italic"></span>  conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>alice<span style="color:#000;font-weight:bold">,</span> RDF<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TYPE</span><span style="color:#000;font-weight:bold">,</span> person<span style="color:#000;font-weight:bold">);</span>
  <span style="color:#998;font-style:italic">// alice&#39;s name is &#34;Alice&#34;
</span><span style="color:#998;font-style:italic"></span>  conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>alice<span style="color:#000;font-weight:bold">,</span> name<span style="color:#000;font-weight:bold">,</span> alicesName<span style="color:#000;font-weight:bold">);</span>
  <span style="color:#998;font-style:italic">// bob is a person
</span><span style="color:#998;font-style:italic"></span>  conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>bob<span style="color:#000;font-weight:bold">,</span> RDF<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TYPE</span><span style="color:#000;font-weight:bold">,</span> person<span style="color:#000;font-weight:bold">);</span>
  <span style="color:#998;font-style:italic">// bob&#39;s name is &#34;Bob&#34;
</span><span style="color:#998;font-style:italic"></span>  conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>bob<span style="color:#000;font-weight:bold">,</span> name<span style="color:#000;font-weight:bold">,</span> bobsName<span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>Of course, it will not always be necessary to use a ValueFactory to create IRIs. In practice, you will find that you quite often retrieve existing IRIs from the repository (for example, by evaluating a query) and then use those values to add new statements. Also, for several well-knowns vocabularies we can simply reuse the predefined constants found in the org.eclipse.rdf4j.model.vocabulary package, and using the ModelBuilder utility you can very quickly create collections of statements without ever touching a ValueFactory.</p>

<p>Retrieving statements works in a very similar way. One way of retrieving statements we have already seen actually: we can get a GraphQueryResult containing statements by evaluating a graph query. However, we can also use direct method calls to retrieve (sets of) statements. For example, to retrieve all statements about Alice, we could do:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">RepositoryResult<span style="color:#000;font-weight:bold">&lt;</span>Statement<span style="color:#000;font-weight:bold">&gt;</span> statements <span style="color:#000;font-weight:bold">=</span> con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStatements</span><span style="color:#000;font-weight:bold">(</span>alice<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">);</span></code></pre></td></tr></table>
</div>
</div>

<p>Similarly to the TupleQueryResult object and other types of query results, the RepositoryResult is an iterator-like object that lazily retrieves each matching statement from the repository when its next() method is called. Note that, like is the case with QueryResult objects, iterating over a RepositoryResult may result in exceptions which you should catch to make sure that the RepositoryResult is always properly closed after use:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">RepositoryResult<span style="color:#000;font-weight:bold">&lt;</span>Statement<span style="color:#000;font-weight:bold">&gt;</span> statements <span style="color:#000;font-weight:bold">=</span> con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStatements</span><span style="color:#000;font-weight:bold">(</span>alice<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
   <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">(</span>statements<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">hasNext</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
      Statement st <span style="color:#000;font-weight:bold">=</span> statements<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">next</span><span style="color:#000;font-weight:bold">();</span>
      <span style="color:#000;font-weight:bold">...</span> <span style="color:#998;font-style:italic">// do something with the statement
</span><span style="color:#998;font-style:italic"></span>   <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
   statements<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">();</span> <span style="color:#998;font-style:italic">// make sure the result object is closed properly
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>Or alternatively, using try-with-resources:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">(</span>RepositoryResult<span style="color:#000;font-weight:bold">&lt;</span>Statement<span style="color:#000;font-weight:bold">&gt;</span> statements <span style="color:#000;font-weight:bold">=</span> con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStatements</span><span style="color:#000;font-weight:bold">(</span>alice<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span>
   <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">(</span>statements<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">hasNext</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
      Statement st <span style="color:#000;font-weight:bold">=</span> statements<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">next</span><span style="color:#000;font-weight:bold">();</span>
      <span style="color:#000;font-weight:bold">...</span> <span style="color:#998;font-style:italic">// do something with the statement
</span><span style="color:#998;font-style:italic"></span>   <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>In the above getStatements() invocation, we see four parameters being passed. The first three represent the subject, predicate and object of the RDF statements which should be retrieved. A null value indicates a wildcard, so the above method call retrieves all statements which have as their subject Alice, and have any kind of predicate and object. The optional fourth parameter indicates whether or not inferred statements should be included or not (you can leave this parameter out, in which case it defaults to ‘true’).</p>

<p>Removing statements again works in a very similar fashion. Suppose we want to retract the statement that the name of Alice is “Alice”):</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">remove</span><span style="color:#000;font-weight:bold">(</span>alice<span style="color:#000;font-weight:bold">,</span> name<span style="color:#000;font-weight:bold">,</span> alicesName<span style="color:#000;font-weight:bold">);</span></code></pre></td></tr></table>
</div>
</div>

<p>Or, if we want to erase all statements about Alice completely, we can do:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">remove</span><span style="color:#000;font-weight:bold">(</span>alice<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">);</span></code></pre></td></tr></table>
</div>
</div>

<h3 id="using-named-graphs-context">Using named graphs/context</h3>

<p>rdf4j supports the notion of context, which you can think of as a way to group sets of statements together through a single group identifier (this identifier can be a blank node or a URI).</p>

<p>A very typical way to use context is tracking provenance of the statements in a repository, that is, which file these statements originate from. For example, consider an application where you add RDF data from different files to a repository, and then one of those files is updated. You would then like to replace the data from that single file in the repository, and to be able to do this you need a way to figure out which statements need to be removed. The context mechanism gives you a way to do that.</p>

<p>Another typical use case is to support named graphs: in the SPARQL query language, named graphs can be queried as subsets of the dataset over which the query is evaluated. In rdf4j, named graphs are implemented via the context mechanism. This means that if you put data in rdf4j in a context, you can query that context as a named graph in SPARQL.</p>

<p>We will start by showing some simple examples of using context in the API. In the following example, we add an RDF document from the Web to our repository, in a context. In the example, we make the context identifier equal to the Web location of the file being uploaded.</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">String location <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;http://example.org/example/example.rdf&#34;</span><span style="color:#000;font-weight:bold">;</span>
String baseURI <span style="color:#000;font-weight:bold">=</span> location<span style="color:#000;font-weight:bold">;</span>
URL url <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> URL<span style="color:#000;font-weight:bold">(</span>location<span style="color:#000;font-weight:bold">);</span>
URI context <span style="color:#000;font-weight:bold">=</span> f<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createURI</span><span style="color:#000;font-weight:bold">(</span>location<span style="color:#000;font-weight:bold">);</span>
conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>url<span style="color:#000;font-weight:bold">,</span> baseURI<span style="color:#000;font-weight:bold">,</span> RDFFormat<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">RDFXML</span><span style="color:#000;font-weight:bold">,</span> context<span style="color:#000;font-weight:bold">);</span></code></pre></td></tr></table>
</div>
</div>

<p>We can now use the context mechanism to specifically address these statements in the repository for retrieve and remove operations:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#998;font-style:italic">// Get all statements in the context
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">(</span>RepositoryResult<span style="color:#000;font-weight:bold">&lt;</span>Statement<span style="color:#000;font-weight:bold">&gt;</span> result <span style="color:#000;font-weight:bold">=</span> conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStatements</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> context<span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span>
   <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">(</span>result<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">hasNext</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
      Statement st <span style="color:#000;font-weight:bold">=</span> result<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">next</span><span style="color:#000;font-weight:bold">();</span>
      <span style="color:#000;font-weight:bold">...</span> <span style="color:#998;font-style:italic">// do something interesting with the result
</span><span style="color:#998;font-style:italic"></span>   <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#998;font-style:italic">// Export all statements in the context to System.out, in RDF/XML format
</span><span style="color:#998;font-style:italic"></span>RDFHandler writer <span style="color:#000;font-weight:bold">=</span> Rio<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createWriter</span><span style="color:#000;font-weight:bold">(</span>RDFFormat<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">RDFXML</span><span style="color:#000;font-weight:bold">,</span> System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">);</span>
conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">export</span><span style="color:#000;font-weight:bold">(</span>context<span style="color:#000;font-weight:bold">,</span> writer<span style="color:#000;font-weight:bold">);</span>
<span style="color:#998;font-style:italic">// Remove all statements in the context from the repository
</span><span style="color:#998;font-style:italic"></span>conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">clear</span><span style="color:#000;font-weight:bold">(</span>context<span style="color:#000;font-weight:bold">);</span></code></pre></td></tr></table>
</div>
</div>

<p>In most methods in the Repository API, the context parameter is a vararg, meaning that you can specify an arbitrary number (zero, one, or more) of context identifiers. This way, you can combine different contexts together. For example, we can very easily retrieve statements that appear in either ‘context1’ or ‘context2’.</p>

<p>In the following example we add information about Bob and Alice again, but this time each has their own context. We also create a new property called ‘creator’ that has as its value the name of the person who is the creator a particular context. The knowledge about creators of contexts we do not add to any particular context, however:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">IRI context1 <span style="color:#000;font-weight:bold">=</span> f<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createIRI</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;http://example.org/context1&#34;</span><span style="color:#000;font-weight:bold">);</span>
IRI context2 <span style="color:#000;font-weight:bold">=</span> f<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createIRI</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;http://example.org/context2&#34;</span><span style="color:#000;font-weight:bold">);</span>
IRI creator <span style="color:#000;font-weight:bold">=</span> f<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createIRI</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;http://example.org/ontology/creator&#34;</span><span style="color:#000;font-weight:bold">);</span>

<span style="color:#998;font-style:italic">// Add stuff about Alice to context1
</span><span style="color:#998;font-style:italic"></span>conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>alice<span style="color:#000;font-weight:bold">,</span> RDF<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TYPE</span><span style="color:#000;font-weight:bold">,</span> person<span style="color:#000;font-weight:bold">,</span> context1<span style="color:#000;font-weight:bold">);</span>
conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>alice<span style="color:#000;font-weight:bold">,</span> name<span style="color:#000;font-weight:bold">,</span> alicesName<span style="color:#000;font-weight:bold">,</span> context1<span style="color:#000;font-weight:bold">);</span>

<span style="color:#998;font-style:italic">// Alice is the creator of context1
</span><span style="color:#998;font-style:italic"></span>conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>context1<span style="color:#000;font-weight:bold">,</span> creator<span style="color:#000;font-weight:bold">,</span> alicesName<span style="color:#000;font-weight:bold">);</span>

<span style="color:#998;font-style:italic">// Add stuff about Bob to context2
</span><span style="color:#998;font-style:italic"></span>conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>bob<span style="color:#000;font-weight:bold">,</span> RDF<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TYPE</span><span style="color:#000;font-weight:bold">,</span> person<span style="color:#000;font-weight:bold">,</span> context2<span style="color:#000;font-weight:bold">);</span>
conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>bob<span style="color:#000;font-weight:bold">,</span> name<span style="color:#000;font-weight:bold">,</span> bobsName<span style="color:#000;font-weight:bold">,</span> context2<span style="color:#000;font-weight:bold">);</span>

<span style="color:#998;font-style:italic">// Bob is the creator of context2
</span><span style="color:#998;font-style:italic"></span>conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>context2<span style="color:#000;font-weight:bold">,</span> creator<span style="color:#000;font-weight:bold">,</span> bobsName<span style="color:#000;font-weight:bold">);</span></code></pre></td></tr></table>
</div>
</div>

<p>Once we have this information in our repository, we can retrieve all statements about either Alice or Bob by using the context vararg:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#998;font-style:italic">// Get all statements in either context1 or context2
</span><span style="color:#998;font-style:italic"></span>RepositoryResult<span style="color:#000;font-weight:bold">&lt;</span>Statement<span style="color:#000;font-weight:bold">&gt;</span> result <span style="color:#000;font-weight:bold">=</span> con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStatements</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> context1<span style="color:#000;font-weight:bold">,</span> context2<span style="color:#000;font-weight:bold">);</span></code></pre></td></tr></table>
</div>
</div>

<p>You should observe that the above RepositoryResult will not contain the information that context1 was created by Alice and context2 by Bob. This is because those statements were added without any context, thus they do not appear in context1 or context2, themselves.</p>

<p>To explicitly retrieve statements that do not have an associated context, we do the following:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#998;font-style:italic">// Get all statements that do not have an associated context
</span><span style="color:#998;font-style:italic"></span>RepositoryResult<span style="color:#000;font-weight:bold">&lt;</span>Statement<span style="color:#000;font-weight:bold">&gt;</span> result <span style="color:#000;font-weight:bold">=</span> con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStatements</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span>Resource<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">);</span></code></pre></td></tr></table>
</div>
</div>

<p>This will give us only the statements about the creators of the contexts, because those are the only statements that do not have an associated context. Note that we have to explicitly cast the null argument to Resource, because otherwise it is ambiguous whether we are specifying a single value or an entire array that is null (a vararg is internally treated as an array). Simply invoking getStatements(s, p, o, null) without an explicit cast will result in an IllegalArgumentException.</p>

<p>We can also get everything that either has no context or is in context1:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#998;font-style:italic">// Get all statements that do not have an associated context, or that are in context1
</span><span style="color:#998;font-style:italic"></span>RepositoryResult<span style="color:#000;font-weight:bold">&lt;</span>Statement<span style="color:#000;font-weight:bold">&gt;</span> result <span style="color:#000;font-weight:bold">=</span> con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStatements</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span>Resource<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> context1<span style="color:#000;font-weight:bold">);</span></code></pre></td></tr></table>
</div>
</div>

<p>So as you can see, you can freely combine contexts in this fashion.</p>

<p>Note:</p>

<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">getStatements<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">);</span></code></pre></div>

<p>is not the same as:</p>

<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">getStatements<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span>Resource<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">);</span></code></pre></div>

<p>The former (without any context id parameter) retrieves all statements in the repository, ignoring any context information. The latter, however, only retrieves statements that explicitly do not have any associated context.</p>

<h3 id="working-with-models-collections-and-iterations">Working with Models, Collections and Iterations</h3>

<p>Most of these examples sofar have been on the level of individual statements. However, the Repository API offers several methods that work with Java Collections of statements, allowing more batch-like update operations.</p>

<p>For example, in the following bit of code, we first retrieve all statements about Alice, put them in a Model (which, as we have seen in the previous sections, is an implementation of java.util.Collection) and then remove them:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.query.QueryResults</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.model.Model</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#998;font-style:italic">// Retrieve all statements about Alice and put them in a Model
</span><span style="color:#998;font-style:italic"></span>RepositoryResult<span style="color:#000;font-weight:bold">&lt;</span>Statement<span style="color:#000;font-weight:bold">&gt;</span> statements <span style="color:#000;font-weight:bold">=</span> con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStatements</span><span style="color:#000;font-weight:bold">(</span>alice<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">);</span>
Model aboutAlice <span style="color:#000;font-weight:bold">=</span> QueryResults<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">asModel</span><span style="color:#000;font-weight:bold">(</span>statements<span style="color:#000;font-weight:bold">);</span>

<span style="color:#998;font-style:italic">// Then, remove them from the repository
</span><span style="color:#998;font-style:italic"></span>con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">remove</span><span style="color:#000;font-weight:bold">(</span>aboutAlice<span style="color:#000;font-weight:bold">);</span></code></pre></td></tr></table>
</div>
</div>

<p>As you can see, the QueryResults class provides a convenient method that takes a CloseableIteration (of which RepositoryResult is a subclass) as input, and returns the Model with the contents of the iterator added to it. It also automatically closes the Result object for you.</p>

<p>In the above code, you first retrieve all statements, put them in a Model, and then remove them. Although this works fine, it can be done in an easier fashion, by simply supplying the resulting object directly:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">remove</span><span style="color:#000;font-weight:bold">(</span>con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStatements</span><span style="color:#000;font-weight:bold">(</span>alice<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">));</span></code></pre></td></tr></table>
</div>
</div>

<p>The RepositoryConnection interface has several variations of add, retrieve and remove operations. See the Javadoc for a full overview of the options.</p>

<h3 id="rdf-collections-and-repositoryconnections">RDF Collections and RepositoryConnections</h3>

<p>In the <a href="../model/">Model API documentation</a> we have already seen how we can use the RDFCollections utility on top of a Model. This makes it very easy to insert any RDF Collection into your Repository - after all a Model can simply be added as follows:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Model rdfList <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">(</span>RepositoryConnection conn <span style="color:#000;font-weight:bold">=</span> repo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
       conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>rdfList<span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>In addition to this the Repository API offers the Connections utility class, which contains some useful utility functions specifically for retrieving RDF Collections from a Repository.</p>

<p>For example, to retrieve all statements corresponding to an RDF Collection identified by the resource node from our Repository, we can do the following:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#998;font-style:italic">// retrieve all statements forming our RDF Collection from the Repository and put
</span><span style="color:#998;font-style:italic">// them in a Model
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">try</span><span style="color:#000;font-weight:bold">(</span>RepositoryConnection conn <span style="color:#000;font-weight:bold">=</span> rep<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
   Model rdfList <span style="color:#000;font-weight:bold">=</span> Connections<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getRDFCollection</span><span style="color:#000;font-weight:bold">(</span>conn<span style="color:#000;font-weight:bold">,</span> node<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> LinkedHashModel<span style="color:#000;font-weight:bold">());</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>Or instead, you can retrieve them in streaming fashion as well:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">try</span><span style="color:#000;font-weight:bold">(</span>RepositoryConnection conn <span style="color:#000;font-weight:bold">=</span> repo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
    Connections<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">consumeRDFCollection</span><span style="color:#000;font-weight:bold">(</span>conn<span style="color:#000;font-weight:bold">,</span> node<span style="color:#000;font-weight:bold">,</span>
		 st <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#998;font-style:italic">// ... do something with the triples forming the collection });
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<h2 id="transactions">Transactions</h2>

<p>So far, we have shown individual operations on repositories: adding statements, removing them, etc. By default, each operation on a RepositoryConnection is immediately sent to the store and committed.</p>

<p>The RepositoryConnection interface supports a full transactional mechanism that allows one to group modification operations together and treat them as a single update: before the transaction is committed, none of the operations in the transaction has taken effect, and after, they all take effect. If something goes wrong at any point during a transaction, it can be rolled back so that the state of the repository is the same as before the transaction started. Bundling update operations in a single transaction often also improves update performance compared to multiple smaller transactions.</p>

<p>We can indicate that we want to begin a transaction by using the RepositoryConnection.begin() method. In the following example, we use a connection to bundle two file addition operations in a single transaction:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">File inputFile1 <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> File<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/path/to/example1.rdf&#34;</span><span style="color:#000;font-weight:bold">);</span>
String baseURI1 <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;http://example.org/example1/&#34;</span><span style="color:#000;font-weight:bold">;</span>
File inputFile2 <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> File<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/path/to/example2.rdf&#34;</span><span style="color:#000;font-weight:bold">);</span>
String baseURI2 <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;http://example.org/example2/&#34;</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">(</span>RepositoryConnection con <span style="color:#000;font-weight:bold">=</span> myRepository<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
   <span style="color:#998;font-style:italic">// start a transaction
</span><span style="color:#998;font-style:italic"></span>   con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">begin</span><span style="color:#000;font-weight:bold">();</span>
   <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#998;font-style:italic">// Add the first file
</span><span style="color:#998;font-style:italic"></span>      con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>inputFile1<span style="color:#000;font-weight:bold">,</span> baseURI1<span style="color:#000;font-weight:bold">,</span> RDFFormat<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">RDFXML</span><span style="color:#000;font-weight:bold">);</span>
      <span style="color:#998;font-style:italic">// Add the second file
</span><span style="color:#998;font-style:italic"></span>      con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>inputFile2<span style="color:#000;font-weight:bold">,</span> baseURI2<span style="color:#000;font-weight:bold">,</span> RDFFormat<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">RDFXML</span><span style="color:#000;font-weight:bold">);</span>
      <span style="color:#998;font-style:italic">// If everything went as planned, we can commit the result
</span><span style="color:#998;font-style:italic"></span>      con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">commit</span><span style="color:#000;font-weight:bold">();</span>
   <span style="color:#000;font-weight:bold">}</span>
   <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>RepositoryException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#998;font-style:italic">// Something went wrong during the transaction, so we roll it back
</span><span style="color:#998;font-style:italic"></span>      con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">rollback</span><span style="color:#000;font-weight:bold">();</span>
   <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>In the above example, we use a transaction to add two files to the repository. Only if both files can be successfully added will the repository change. If one of the files can not be added (for example because it can not be read), then the entire transaction is cancelled and none of the files is added to the repository.</p>

<p>As you can see, we open a new try block after calling the begin() method (line 9 and further). The purpose of this is to be able to catch any errors that happen during transaction execution, so that we can explicitly call rollback() on the transaction (line 19). If you prefer your code shorter, you can leave this out, and just do this:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">(</span>RepositoryConnection con <span style="color:#000;font-weight:bold">=</span> myRepository<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
   <span style="color:#998;font-style:italic">// start a transaction
</span><span style="color:#998;font-style:italic"></span>   con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">begin</span><span style="color:#000;font-weight:bold">();</span>
   <span style="color:#998;font-style:italic">// Add the first file
</span><span style="color:#998;font-style:italic"></span>   con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>inputFile1<span style="color:#000;font-weight:bold">,</span> baseURI1<span style="color:#000;font-weight:bold">,</span> RDFFormat<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">RDFXML</span><span style="color:#000;font-weight:bold">);</span>
   <span style="color:#998;font-style:italic">// Add the second file
</span><span style="color:#998;font-style:italic"></span>   con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>inputFile2<span style="color:#000;font-weight:bold">,</span> baseURI2<span style="color:#000;font-weight:bold">,</span> RDFFormat<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">RDFXML</span><span style="color:#000;font-weight:bold">);</span>
   <span style="color:#998;font-style:italic">// If everything went as planned, we can commit the result
</span><span style="color:#998;font-style:italic"></span>   con<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">commit</span><span style="color:#000;font-weight:bold">();</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>The close() method, which is automatically invoked by Java when the try-with resources block ends, will also ensure that an unfinished transaction is rolled back (it will also log a warning about this).
A RepositoryConnection only supports one active transaction at a time. You can check at any time whether a transaction is active on your connection by using the isActive() method. If you need concurrent transactions, you will need to use several separate RepositoryConnections.</p>

<h3 id="transaction-isolation-levels">Transaction Isolation Levels</h3>

<p>Any transaction operates according to a certain transaction isolation level. A transaction isolation level dictates who can &lsquo;see&rsquo; the updates that are perfomed as part of the transaction while that transaction is active, as well as how concurrent transactions interact with each other.</p>

<p>The following transaction isolation levels are available:</p>

<ul>
<li><p><code>NONE</code> The lowest isolation level; transactions can see their own changes, but may not be able to roll them back, and no support isolation among transactions is guaranteed. This isolation level is typically used for things like bulk data upload operations.</p></li>

<li><p><code>READ_UNCOMMITTED</code> Transactions can be rolled back, but are not necessarily isolated: concurrent transactions may be able to see other’s uncommitted data (so-called ‘dirty reads’).</p></li>

<li><p><code>READ_COMMITTED</code> In this transaction isolation level, only data from concurrent transactions that has been committed can be seen by the current transaction. However, consecutive reads within the same transaction may see different results. This isolation level is typically used for long-lived operations.</p></li>

<li><p><code>SNAPSHOT_READ</code> In addition to being <code>READ_COMMITTED</code>, query results in this isolation level will observe a consistent snapshot. Changes occurring to the data while a query is evaluated will not affect that query’s result. This isolation level is typically used in scenarios where there multiple concurrent transactions that do not conflict with each other.</p></li>

<li><p><code>SNAPSHOT</code> In addition to being <code>SNAPSHOT_READ</code>, succesful transactions in this isolation level will operate against a particular dataset snapshot. Transactions in this isolation level will either see the complete effects of other transactions (consistently throughout) or not at all. This isolation level is typically used in scenarios where a write operation depends on the result of a previous read operation.</p></li>

<li><p><code>SERIALIZABLE</code> In addition to <code>SNAPSHOT</code>, this isolation level requires that all other transactions must appear to occur either completely before or completely after a succesful serializable transaction. This isolation is typically used when multiple concurrent transactions are likely to conflict.</p></li>
</ul>

<p>Which transaction isolation level is active is dependent on the actual store the action is performed upon. In addition, not all the transaction isolation levels listed above are by necessity supported by every store.</p>

<p>By default, both the memory store and the native store use the <code>SNAPSHOT_READ</code> transaction isolation level. In addition, both of them support the <code>NONE</code>, <code>READ_COMMITTED</code>, <code>SNAPSHOT</code>, and <code>SERIALIZABLE</code> levels.</p>

<p>The native and memory store use an optimistic locking scheme. This means that these stores allow multiple concurrent write operations, and set transaction locks &lsquo;optimistically&rsquo;, that is, they assume that no conflicts will occur. If a conflict does occur, an exception is thrown on commit, and the calling user has the option to replay the same transaction with the updated state of the store. This setup significantly reduces the risk of deadlocks, and makes a far greater degree of parallel processing possible, with the downside of having to deal with possible errors thrown to prevent inconsistencies. In cases where concurrent transactions are likely to conflict, the user is advised to use the SERIALIZABLE isolation level.</p>

<p>You can specify the transaction isolation level by means of an optional parameter on the begin() method. For example, to start a transaction that uses SERIALIZABLE isolation:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">(</span>RepositoryConnection conn <span style="color:#000;font-weight:bold">=</span> rep<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
    conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">begin</span><span style="color:#000;font-weight:bold">(</span>IsolationLevels<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">SERIALIZABLE</span><span style="color:#000;font-weight:bold">);</span>
     <span style="color:#000;font-weight:bold">....</span>
    conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">commit</span><span style="color:#000;font-weight:bold">();</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>A transaction isolation level is a sort of contract, that is, a set of guarantees of what will minimally happen while the transaction is active. As such, a store will make a best effort to honor the guarantees of the requested isolation level. If it does not support the specific isolation level being requested, it will attempt to use a level it does support that offers minimally the same guarantees.</p>

<h3 id="automated-transaction-handling">Automated transaction handling</h3>

<p>Although transactions are a convenient mechanism, having to always call begin() and commit() to explictly start and stop your transactions can be tedious. rdf4j offers a number of convenience utility functions to automate this part of transaction handling, using the Repositories utility class.</p>

<p>As an example, consider this bit of transactional code. It opens a connection, starts a transaction, adds two RDF statements, and then commits. It also makes sure that it rolls back the transaction if something went wrong, and it ensures that once we’re done, the connection is closed.</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">ValueFactory f <span style="color:#000;font-weight:bold">=</span> myRepository<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValueFactory</span><span style="color:#000;font-weight:bold">();</span>
IRI bob <span style="color:#000;font-weight:bold">=</span> f<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createIRI</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;urn:bob&#34;</span><span style="color:#000;font-weight:bold">);</span>
RepositoryConnection conn <span style="color:#000;font-weight:bold">=</span> myRepository<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">();</span>
<span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
   conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">begin</span><span style="color:#000;font-weight:bold">();</span>
   conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>bob<span style="color:#000;font-weight:bold">,</span> RDF<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TYPE</span><span style="color:#000;font-weight:bold">,</span> FOAF<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">PERSON</span><span style="color:#000;font-weight:bold">);</span>
   conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>bob<span style="color:#000;font-weight:bold">,</span> FOAF<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NAME</span><span style="color:#000;font-weight:bold">,</span> f<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createLiteral</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Bob&#34;</span><span style="color:#000;font-weight:bold">));</span>
   conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">commit</span><span style="color:#000;font-weight:bold">();</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>RepositoryException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
   conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">rollback</span><span style="color:#000;font-weight:bold">();</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
   conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">();</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>That’s an awful lot of code for just inserting two triples. The same thing can be achieved with far less boilerplate code, as follows:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">ValueFactory f <span style="color:#000;font-weight:bold">=</span> myRepository<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValueFactory</span><span style="color:#000;font-weight:bold">();</span>
IRI bob <span style="color:#000;font-weight:bold">=</span> f<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createIRI</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;urn:bob&#34;</span><span style="color:#000;font-weight:bold">);</span>
Repositories<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">consume</span><span style="color:#000;font-weight:bold">(</span>myRepository<span style="color:#000;font-weight:bold">,</span> conn <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
  conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>bob<span style="color:#000;font-weight:bold">,</span> RDF<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">TYPE</span><span style="color:#000;font-weight:bold">,</span> FOAF<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">PERSON</span><span style="color:#000;font-weight:bold">);</span>
  conn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>bob<span style="color:#000;font-weight:bold">,</span> RDFS<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">LABEL</span><span style="color:#000;font-weight:bold">,</span> f<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createLiteral</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Bob&#34;</span><span style="color:#000;font-weight:bold">));</span>
<span style="color:#000;font-weight:bold">});</span></code></pre></td></tr></table>
</div>
</div>

<p>As you can see, using Repositories.consume(), we do not explicitly begin or commit a transaction. We don’t even open and close a connection explicitly – this is all handled internally. The method also ensures that the transaction is rolled back if an exception occurs.</p>

<p>This pattern is useful for simple transactions, however as we’ve seen above, we sometimes do need to explicitly call begin(), especially if we want to modify the transaction isolation level.</p>

<h2 id="multithreaded-repository-access">Multithreaded Repository Access</h2>

<p>The Repository API supports multithreaded access to a store: multiple concurrent threads can obtain connections to a Repository and query and performs operations on it simultaneously (though, depending on the transaction isolation level, access may occassionally block as a thread needs exclusive access).</p>

<p>The Repository object is thread-safe, and can be safely shared and reused across multiple threads (a good way to do this is via a RepositoryProvider).</p>

<p>NOTE: RepositoryConnection is not thread-safe. This means that you should not try to share a single RepositoryConnection over multiple threads. Instead, ensure that each thread obtains its own RepositoryConnection from a shared Repository object. You can use transaction isolation levels to control visibility of concurrent updates between threads.</p>
  
        
      </div>
      <div class="col-md-6  padding-bottom-30 padding-top-10">
        <b>Table of Contents</b>
        <nav id="TableOfContents">
<ul>
<li><a href="#the-repository-api">The Repository API</a>
<ul>
<li><a href="#creating-a-repository-object">Creating a Repository object</a>
<ul>
<li><a href="#creating-a-main-memory-rdf-repository">Creating a main memory RDF Repository</a></li>
<li><a href="#creating-a-native-rdf-repository">Creating a Native RDF Repository</a></li>
<li><a href="#creating-a-repository-with-rdf-schema-inferencing">Creating a repository with RDF Schema inferencing</a></li>
<li><a href="#creating-a-repository-with-a-custom-inferencing-rule">Creating a Repository with a Custom Inferencing Rule</a></li>
<li><a href="#accessing-a-server-side-repository">Accessing a server-side repository</a></li>
<li><a href="#accessing-a-sparql-endpoint">Accessing a SPARQL endpoint</a></li>
<li><a href="#the-repositorymanager-and-repositoryprovider">The RepositoryManager and RepositoryProvider</a></li>
<li><a href="#the-remoterepositorymanager">The RemoteRepositoryManager</a></li>
<li><a href="#sharing-managers-with-the-repositoryprovider">Sharing Managers with the RepositoryProvider</a></li>
<li><a href="#creating-a-federation">Creating a Federation</a></li>
</ul></li>
<li><a href="#using-a-repository-repositoryconnections">Using a repository: RepositoryConnections</a>
<ul>
<li><a href="#adding-rdf-to-a-repository">Adding RDF to a repository</a></li>
<li><a href="#querying-a-repository">Querying a repository</a>
<ul>
<li><a href="#select-tuple-queries">SELECT: tuple queries</a></li>
<li><a href="#a-tuple-query-in-a-single-line-of-code-the-repositories-utility">A tuple query in a single line of code: the Repositories utility</a></li>
<li><a href="#using-tuplequeryresulthandlers">Using TupleQueryResultHandlers</a></li>
<li><a href="#construct-describe-graph-queries">CONSTRUCT/DESCRIBE: graph queries</a></li>
<li><a href="#doing-a-graph-query-in-a-single-line-of-code">Doing a graph query in a single line of code</a></li>
<li><a href="#using-rdfhandlers">Using RDFHandlers</a></li>
<li><a href="#preparing-and-reusing-queries">Preparing and Reusing Queries</a></li>
</ul></li>
<li><a href="#creating-retrieving-removing-individual-statements">Creating, retrieving, removing individual statements</a></li>
<li><a href="#using-named-graphs-context">Using named graphs/context</a></li>
<li><a href="#working-with-models-collections-and-iterations">Working with Models, Collections and Iterations</a></li>
<li><a href="#rdf-collections-and-repositoryconnections">RDF Collections and RepositoryConnections</a></li>
</ul></li>
<li><a href="#transactions">Transactions</a>
<ul>
<li><a href="#transaction-isolation-levels">Transaction Isolation Levels</a></li>
<li><a href="#automated-transaction-handling">Automated transaction handling</a></li>
</ul></li>
<li><a href="#multithreaded-repository-access">Multithreaded Repository Access</a></li>
</ul></li>
</ul>
</nav>
      </div>
    </div>
    
  </div>
</main>

  
  
<p id="back-to-top">
  <a class="visible-xs" href="#top">Back to the top</a>
</p>
<footer id="solstice-footer">
  <div class="container">
    <div class="row">
      <section class="col-sm-6 hidden-print" id="footer-eclipse-foundation">
        <h2 class="section-title">Eclipse Foundation</h2>
        <ul class="nav">
          <li><a href="https://www.eclipse.org/org/">About Us</a></li>
          <li><a href="https://www.eclipse.org/org/foundation/contact.php">Contact Us</a></li>
          <li><a href="https://www.eclipse.org/donate">Donate</a></li>
          <li><a href="https://www.eclipse.org/org/documents/">Governance</a></li>
          <li><a href="https://www.eclipse.org/artwork/">Logo and Artwork</a></li>
          <li><a href="https://www.eclipse.org/org/foundation/directors.php">Board of Directors</a></li>
        </ul>
      </section>
      <section class="col-sm-6 hidden-print" id="footer-legal">
        <h2 class="section-title">Legal</h2>
        <ul class="nav">
          <li><a href="https://www.eclipse.org/legal/privacy.php">Privacy Policy</a></li>
          <li><a href="https://www.eclipse.org/legal/termsofuse.php">Terms of Use</a></li>
          <li><a href="https://www.eclipse.org/legal/copyright.php">Copyright Agent</a></li>
          <li><a href="https://www.eclipse.org/org/documents/edl-v10.php">Eclipse Distribution License</a></li>
          <li><a href="https://www.eclipse.org/legal/">Legal Resources </a></li>
        </ul>
      </section>
      <section class="col-sm-6 hidden-print" id="footer-useful-links">
        <h2 class="section-title">Useful Links</h2>
        <ul class="nav">
          <li><a href="https://github.com/eclipse/rdf4j/issues/">Report a Bug</a></li>
          <li><a href="/documentation/">Documentation</a></li>
          <li><a href="https://github.com/eclipse/rdf4j/blob/master/.github/CONTRIBUTING.md">How to Contribute</a></li>
        </ul>
      </section>
      <section class="col-sm-6 hidden-print" id="footer-other">
        <h2 class="section-title">Other</h2>
        <ul class="nav">
          <li><a href="https://www.eclipse.org/ide/">IDE and Tools</a></li>
          <li><a href="https://www.eclipse.org/projects">Community of Projects</a></li>
          <li><a href="https://www.eclipse.org/org/workinggroups/">Working Groups</a></li>
          <li><a href="https://www.eclipse.org/org/research/">Research@Eclipse</a></li>
          <li><a href="https://status.eclipse.org">Service Status</a></li>
        </ul>
      </section>
      <div class="col-sm-24 margin-top-20">
        <div class="row">
          <div id="copyright" class="col-md-16">
            <p id="copyright-text">Copyright &copy; Eclipse Foundation, Inc. All Rights Reserved.</p>
          </div>
          
        </div>
      </div>
      <a href="#" class="scrollup">Back to the top</a>
    </div>
  </div>
</footer>

<script src="https://www.eclipse.org/eclipse.org-common/themes/solstice/public/javascript/main.min.js"></script>

</body>
</html>

  
</body>
</html>

