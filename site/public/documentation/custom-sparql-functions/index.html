
<!DOCTYPE html>
<html lang="en">
<head>
  
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Creating custom SPARQL functions | The Eclipse Foundation</title>
<meta property="og:title" content="Creating custom SPARQL functions | The Eclipse Foundation" />
<meta name="twitter:title" content="Creating custom SPARQL functions | The Eclipse Foundation" />
<meta name="description" content="Creating custom SPARQL functions The SPARQL query language is extensible by nature: it allows you to add your own custom functions if the standard set of operators is not sufficient for your needs. The RDF4J SPARQL engine has been designed with this extensibility in mind: you can define your own custom function and use it as part of your SPARQL queries.
In this short tutoral, we&rsquo;ll create a simple custom function and add it RDF4J.">
<meta property="og:description" content="Creating custom SPARQL functions The SPARQL query language is extensible by nature: it allows you to add your own custom functions if the standard set of operators is not sufficient for your needs. The RDF4J SPARQL engine has been designed with this extensibility in mind: you can define your own custom function and use it as part of your SPARQL queries.
In this short tutoral, we&rsquo;ll create a simple custom function and add it RDF4J.">
<meta name="twitter:description" content="Creating custom SPARQL functions The SPARQL query language is extensible by nature: it allows you to add your own custom functions if the standard set of operators is not sufficient for your needs. …">
<meta name="author" content="Christopher Guindon"/>
<link href='https://rdf4j.eclipse.org/images/favicon.png' rel='icon' type='image/x-icon'/>
<meta property="og:image" content="https://rdf4j.eclipse.org/images/rdf4j-logo-orange-114.png" />
<meta name="twitter:image" content="https://rdf4j.eclipse.org/images/rdf4j-logo-orange-114.png" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@EclipseFdn" />
<meta name="twitter:creator" content="@EclipseFdn" />
<meta property="og:url" content="https://rdf4j.eclipse.org/documentation/custom-sparql-functions/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Eclipse rdf4j" />
<meta name="keywords" content="hugo, solstice, eclipse foundatiou">


<meta name="generator" content="Hugo 0.40.1" />
<link rel="canonical" href="https://rdf4j.eclipse.org/documentation/custom-sparql-functions/" />
<link rel="alternate" href="https://rdf4j.eclipse.org/index.xml" type="application/rss+xml" title="Eclipse rdf4j">

<link rel="stylesheet" href="https://eclipse.org/eclipse.org-common/themes/solstice/public/stylesheets/quicksilver.min.css">
<link rel="stylesheet" href="/css/rdf4j.css">


  
<link href="//fonts.googleapis.com/css?family=Libre+Franklin:400,700,300,600,100" rel="stylesheet" type="text/css"/>

  
</head>
<body>
  
<a class="sr-only" href="#content">Skip to main content</a>
<header class="header-wrapper" id="header-wrapper">
  

<div class="clearfix toolbar-container-wrapper">
  <div class="container">
    <div class="text-right toolbar-row row hidden-print">
      <div class="col-md-24 row-toolbar-col">
        <ul class="list-inline">
          <li><a href="https://accounts.eclipse.org/user/edit" class="" data-tab-destination="tab-profile"><i class="fa fa-edit fa-fw"></i> Edit my account</a></li>
          <li><a class="toolbar-link toolbar-manage-cookies dropdown-toggle"><i class="fa fa-wrench"></i> Manage Cookies</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>
<div class="container">
  <div class="row" id="header-row">
    <div class="col-sm-5 col-md-4" id="header-left">
      <div class="wrapper-logo-default">
          <a title="Eclipse rdf4j" href="https://rdf4j.eclipse.org/">
            <img width="140" class="logo-eclipse-default img-responsive hidden-xs" src="https://rdf4j.eclipse.org/images/rdf4j-logo-orange-114.png" alt="Eclipse rdf4j" />
          </a>
        
      </div>
    </div>
    
    <div class="col-sm-19 col-md-20 reset margin-top-10" id="main-menu-wrapper">
    
      <div class="navbar yamm" id="main-menu">
        <div class="navbar-collapse collapse reset float-right" id="navbar-main-menu">
          <ul class="nav navbar-nav">
            



<li>
  <a class="" href="/news/">
  
  News
  </a>
  
</li>


<li class="dropdown">
  <a href="#" data-toggle="dropdown" class="dropdown-toggle">
    
    
    <span>About</span>
    <b class="caret"></b>
  </a>
  <ul class="dropdown-menu">
    
    <li><a href="/about/">Eclipse rdf4j</a> </li>
    
    <li><a href="/databases/">Rdf4j databases</a> </li>
    
    <li><a href="/related/">Related projects</a> </li>
    
  </ul>
  
</li>


<li>
  <a class="" href="/documentation/">
  
  Documentation
  </a>
  
</li>


<li>
  <a class="" href="/download/">
  
  Download
  </a>
  
</li>


<li>
  <a class="" href="/support/">
  
  Support
  </a>
  
</li>





          </ul>
        </div>
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-main-menu">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          </button>
          <div class="wrapper-logo-mobile">
            
              <a class="navbar-brand visible-xs" title="Eclipse rdf4j" href="https://rdf4j.eclipse.org/">
                <img width="140" class="logo-eclipse-default-mobile img-responsive" src="https://rdf4j.eclipse.org/images/rdf4j-logo-orange-114.png" alt="Eclipse rdf4j" />
              </a>
            
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  


</header>

  
<section class="default-breadcrumbs hidden-print" id="breadcrumb">
  <div class="container">
  <h3 class="sr-only">Breadcrumbs</h3>
  <div class="row">
    <div class="col-sm-24">
      <ol class="breadcrumb">
        
      
      
      
      
      
      <li>
        <a href="https://rdf4j.eclipse.org/">Eclipse rdf4j</a>
      </li>
      
      
      <li>
        <a href="https://rdf4j.eclipse.org/documentation/">Documentation</a>
      </li>
      
      
      <li class="active">
        <a href="https://rdf4j.eclipse.org/documentation/custom-sparql-functions/">Creating custom SPARQL functions</a>
      </li>
      
      </ol>
      
    </div>
  </div>
</section>

  
<main>
  <div class="container">
    
    <div class="row">
      <div class="col-md-18 padding-bottom-30">
        
        
        

<h1 id="creating-custom-sparql-functions">Creating custom SPARQL functions</h1>

<p>The SPARQL query language is extensible by nature: it allows you to add your own custom functions if the standard set of operators is not sufficient for your needs. The RDF4J SPARQL engine has been designed with this extensibility in mind: you can define your own custom function and use it as part of your SPARQL queries.</p>

<p>In this short tutoral, we&rsquo;ll create a simple custom function and add it RDF4J. Specifically, we are going to implement a boolean function that detects if some string literal is a <a href="https://en.wikipedia.org/wiki/Palindrome" target="_blank">palindrome</a>.</p>

<h2 id="the-palindrome-function">The palindrome function</h2>

<p>Suppose we have the following RDF data:</p>

<pre><code>@prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;.
@prefix ex: &lt;http://example.org/&gt; .

ex:a rdfs:label &quot;step on no pets&quot; .
ex:b rdfs:label &quot;go on, try it&quot; .
</code></pre>

<p>We would like to be able to formulate a SPARQL query that allows us to retrieve all resources that have a palindrome as their label:</p>

<pre><code>PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt; 
PREFIX cfn: &lt;http://example.org/custom-function/&gt;
SELECT ?x ?label
WHERE {
   ?x rdfs:label ?label .
   FILTER(cfn:palindrome(str(?label)))
}
</code></pre>

<p>The expected result of this query, given the above data, would be:</p>

<table border=1 cellpadding=2 style="border: solid 1px">
<tr><th><code>x</code></th><th><code>label</code></th></tr>
<tr><td><code>ex:a</code></td><td><code>"step on no pets"</code></td></tr>
</table>

<p>Unfortunately, the function <code>cfn:palindrome</code> is not a standard SPARQL function, so this query won’t work: the RDF4J SPARQL engine will simply report an error.</p>

<p>We could of course retrieve all label values in the database and then do some checking ourselves on these values, to detect if they’re palindromes. However if we add a custom function instead, we remove the need to scan over the entire database: the SPARQL engine itself can determine if a value is a valid palindrome or not, which removes the need for us to loop over all possible values.</p>

<p>There’s two basic steps in adding custom functions to RDF4J:</p>

<ol>
<li>implementing a Java class for the function;</li>
<li>creating a JAR file with your function code in it and an Service Provider Interface (SPI) configuration.</li>
</ol>

<h2 id="implementing-the-custom-function-as-a-java-class">Implementing the custom function as a Java class</h2>

<p>In the RDF4J SPARQL engine, functions are expected to implement the <code><a href='https://rdf4j.eclipse.org/javadoc/latest/org/eclipse/rdf4j//query/algebra/evaluation/Function.html'>Function</a></code>
 interface.</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">org.eclipser.rdf4j.examples.function</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.query.algebra.evaluation.function.Function</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PalindromeFunction</span> <span style="color:#000;font-weight:bold">implements</span> Function <span style="color:#000;font-weight:bold">{</span> <span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>The <code>Function</code> interface defines two methods: <code>evaluate()</code> and <code>getURI()</code>. The latter of these is a simple method that returns a string representation of the URI of the function:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#998;font-style:italic">// define a constant for the namespace of our custom function
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> String NAMESPACE <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;http://example.org/custom-function/&#34;</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * return the URI &#39;http://example.org/custom-function/palindrome&#39; as a String
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">getURI</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">return</span> NAMESPACE <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;palindrome&#34;</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>The real proof of the pudding is in the <code>evaluate()</code> method: this is where the function logic is implemented. In other words, in this method we check the incoming value to see if it is, first of all, a valid argument for the function, and second of all, a palindrome, and return the result.</p>

<p><a href="https://github.com/eclipse/rdf4j-doc/tree/master/examples/src/main/java/org/eclipse/rdf4j/examples/function/PalindromeFunction.java">Example 1</a>
 show how we put everything together:</p>

<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#000;font-weight:bold">package</span> <span style="color:#555">org.eclipse.rdf4j.examples.function</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.model.Literal</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.model.Value</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.model.ValueFactory</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.query.algebra.evaluation.ValueExprEvaluationException</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.eclipse.rdf4j.query.algebra.evaluation.function.Function</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * An example custom SPARQL function that detects palindromes
</span><span style="color:#998;font-style:italic">     * 
</span><span style="color:#998;font-style:italic">     * @author Jeen Broekstra
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PalindromeFunction</span> <span style="color:#000;font-weight:bold">implements</span> Function <span style="color:#000;font-weight:bold">{</span>

        <span style="color:#998;font-style:italic">// define a constant for the namespace of our custom function
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> String NAMESPACE <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;http://example.org/custom-function/&#34;</span><span style="color:#000;font-weight:bold">;</span>

        <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">         * return the URI &#39;http://example.org/custom-function/palindrome&#39; as a
</span><span style="color:#998;font-style:italic">         * String
</span><span style="color:#998;font-style:italic">         */</span>
        <span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">getURI</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">return</span> NAMESPACE <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;palindrome&#34;</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">         * Executes the palindrome function.
</span><span style="color:#998;font-style:italic">         *
</span><span style="color:#998;font-style:italic">         * @return A boolean literal representing true if the input argument is a
</span><span style="color:#998;font-style:italic">         *         palindrome, false otherwise.
</span><span style="color:#998;font-style:italic">         * @throws ValueExprEvaluationException
</span><span style="color:#998;font-style:italic">         *         if more than one argument is supplied or if the supplied argument
</span><span style="color:#998;font-style:italic">         *         is not a literal.
</span><span style="color:#998;font-style:italic">         */</span>
        <span style="color:#000;font-weight:bold">public</span> Value <span style="color:#900;font-weight:bold">evaluate</span><span style="color:#000;font-weight:bold">(</span>ValueFactory valueFactory<span style="color:#000;font-weight:bold">,</span> Value<span style="color:#000;font-weight:bold">...</span> args<span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000;font-weight:bold">throws</span> ValueExprEvaluationException
            <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#998;font-style:italic">// our palindrome function expects only a single argument, so throw an error
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">// if there&#39;s more than one
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span> <span style="color:#000;font-weight:bold">!=</span> 1<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> ValueExprEvaluationException<span style="color:#000;font-weight:bold">(</span>
                            <span style="color:#d14">&#34;palindrome function requires&#34;</span> 
                            <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;exactly 1 argument, got &#34;</span>
                            <span style="color:#000;font-weight:bold">+</span> args<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span><span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">}</span>
                Value arg <span style="color:#000;font-weight:bold">=</span> args<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">];</span>
                <span style="color:#998;font-style:italic">// check if the argument is a literal, if not, we throw an error
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(!(</span>arg <span style="color:#000;font-weight:bold">instanceof</span> Literal<span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> ValueExprEvaluationException<span style="color:#000;font-weight:bold">(</span>
                            <span style="color:#d14">&#34;invalid argument (literal expected): &#34;</span> <span style="color:#000;font-weight:bold">+</span> arg<span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">}</span>

                <span style="color:#998;font-style:italic">// get the actual string value that we want to check for palindrome-ness.
</span><span style="color:#998;font-style:italic"></span>                String label <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">((</span>Literal<span style="color:#000;font-weight:bold">)</span>arg<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">getLabel</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#998;font-style:italic">// we invert our string
</span><span style="color:#998;font-style:italic"></span>                String inverted <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> label<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">-</span> 1<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&gt;=</span> 0<span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">--)</span> <span style="color:#000;font-weight:bold">{</span>
                    inverted <span style="color:#000;font-weight:bold">+=</span> label<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">charAt</span><span style="color:#000;font-weight:bold">(</span>i<span style="color:#000;font-weight:bold">);</span>
                <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#998;font-style:italic">// a string is a palindrome if it is equal to its own inverse
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#458;font-weight:bold">boolean</span> palindrome <span style="color:#000;font-weight:bold">=</span> inverted<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">equalsIgnoreCase</span><span style="color:#000;font-weight:bold">(</span>label<span style="color:#000;font-weight:bold">);</span>

                <span style="color:#998;font-style:italic">// a function is always expected to return a Value object, so we
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">// return our boolean result as a Literal
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">return</span> valueFactory<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createLiteral</span><span style="color:#000;font-weight:bold">(</span>palindrome<span style="color:#000;font-weight:bold">);</span>
            <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span></code></pre></td></tr></table>
</div>
</div>

<p>You are completely free to implement your function logic: in the above example, we have created a function that only returns <code>true</code> or <code>false</code>, but since the actual return type of an RDF4J function is <code><a href='https://rdf4j.eclipse.org/javadoc/latest/org/eclipse/rdf4j/model/Value.html'>Value</a></code>
, you can create functions that return string literals, numbers, dates, or even IRIs or blank nodes.</p>

<p>There are two important things to keep in mind though:</p>

<ul>
<li>the <code>evaluate()</code> method is invoked for every single solution in the query result. So you should make sure that the implementation of your function is not overly complex and memory-intensive.<br /></li>
<li>RDF4J treats functions as singletons. This means that you should not &ldquo;keep state&rdquo; as part of your function; for example storing intermediate results in a private object field. This state will carry over between different uses of the function and even between different queries using it, making your results inconsistent.</li>
</ul>

<p>Once we have created the Java class for our function, we need some way to make the RDF4J SPARQL engine aware of it. This is where the Service Provider Interface (SPI) comes into play.</p>

<h2 id="creating-an-spi-configuration">Creating an SPI configuration</h2>

<p>RDF4J&rsquo;s set of SPARQL functions is dynamically determined through the use of a <code>java.util.ServiceLoader</code> class. Specifically, RDF4J has a class called <code><a href='https://rdf4j.eclipse.org/javadoc/latest/org/eclipse/rdf4j//query/algebra/evaluation/function/FunctionRegistry.html'>FunctionRegistry</a></code>
 which keeps track of all implementations of the <code>Function</code> interface. Java’s SPI mechanism depends on the presence of configuration files in the JAR files that contain service implementations. This configuration file is expected to be present in the directory <code>META-INF/services</code> in your JAR file.</p>

<p>In the case of the SPARQL function registry, the name of this configuration file should be <code>org.eclipse.rdf4j.query.algebra.evaluation.function.Function</code> (in other words, the file name is equal to the fully-qualified name of the service interface we are providing an implementation for). The contents are really quite simple: an SPI configuration is a text file, containing the fully-qualified names of each Java class that provides an SPI implementation, one on each line. So in our case, the contents of the file would be:</p>

<p>org.eclipse.rdf4j.example.function.PalindromeFunction</p>

<p>Apart from this configuration file, your JAR file should of course also contain the actual compiled class. All of this is fairly easy to do, for example from your Eclipse project:</p>

<ol>
<li>create a directory <code>META-INF</code> and a subdirectory <code>META-INF/services</code> within the <code>src</code> directory of your project (or, if you use Maven, within <code>src/main/resources</code>) See <a href="https://github.com/eclipse/rdf4j-doc/tree/master/examples/src/main/resources" target="_blank">our example resources dir</a> for an example;</li>
<li>Add a text file named <code>org.eclipse.rdf4j.query.algebra.evaluation.function.Function</code> to this new directory. Make sure it contains a single line with the fully qualified name of your custom function class (in our example, that’s <code>org.eclipse.rdf4j.example.function.PalindromeFunction</code>);</li>
<li>Use Eclipse’s export function (or alternatively Maven’s <code>package</code> command) to create a JAR file (select the project, click ‘File’ -&gt; ‘Export’ -&gt; ‘JAR file’). Make sure the JAR file produced contains your compiled code and the sevice registry config file.</li>
</ol>

<p>Once you have a proper JAR file, you need to add it the runtime classpath of your RDF4J project (or if you&rsquo;re aiming to use this in an RDF4J Server, add it to the RDF4J Server webapp classpath and restart). After that, you’re done: RDF4J should automatically pick up your new custom function, you can from now on use it in your SPARQL queries.</p>

<h2 id="further-reading">Further reading</h2>

<ul>
<li><a href="http://docs.oracle.com/javase/tutorial/sound/SPI-intro.html" target="_blank">Introduction to the Service Provider Interface</a> - Oracle Java documentation.</li>
</ul>

<p>If you require any further help, you can <a href="http://rdf4j.org/support" target="_blank">contact us to get support</a>. We welcome your feedback.</p>
  
        
      </div>
      <div class="col-md-6  padding-bottom-30 padding-top-10">
        <b>Table of Contents</b>
        <nav id="TableOfContents">
<ul>
<li><a href="#creating-custom-sparql-functions">Creating custom SPARQL functions</a>
<ul>
<li><a href="#the-palindrome-function">The palindrome function</a></li>
<li><a href="#implementing-the-custom-function-as-a-java-class">Implementing the custom function as a Java class</a></li>
<li><a href="#creating-an-spi-configuration">Creating an SPI configuration</a></li>
<li><a href="#further-reading">Further reading</a></li>
</ul></li>
</ul>
</nav>
      </div>
    </div>
    
  </div>
</main>

  
  
<p id="back-to-top">
  <a class="visible-xs" href="#top">Back to the top</a>
</p>
<footer id="solstice-footer">
  <div class="container">
    <div class="row">
      <section class="col-sm-6 hidden-print" id="footer-eclipse-foundation">
        <h2 class="section-title">Eclipse Foundation</h2>
        <ul class="nav">
          <li><a href="https://www.eclipse.org/org/">About Us</a></li>
          <li><a href="https://www.eclipse.org/org/foundation/contact.php">Contact Us</a></li>
          <li><a href="https://www.eclipse.org/donate">Donate</a></li>
          <li><a href="https://www.eclipse.org/org/documents/">Governance</a></li>
          <li><a href="https://www.eclipse.org/artwork/">Logo and Artwork</a></li>
          <li><a href="https://www.eclipse.org/org/foundation/directors.php">Board of Directors</a></li>
        </ul>
      </section>
      <section class="col-sm-6 hidden-print" id="footer-legal">
        <h2 class="section-title">Legal</h2>
        <ul class="nav">
          <li><a href="https://www.eclipse.org/legal/privacy.php">Privacy Policy</a></li>
          <li><a href="https://www.eclipse.org/legal/termsofuse.php">Terms of Use</a></li>
          <li><a href="https://www.eclipse.org/legal/copyright.php">Copyright Agent</a></li>
          <li><a href="https://www.eclipse.org/org/documents/edl-v10.php">Eclipse Distribution License</a></li>
          <li><a href="https://www.eclipse.org/legal/">Legal Resources </a></li>
        </ul>
      </section>
      <section class="col-sm-6 hidden-print" id="footer-useful-links">
        <h2 class="section-title">Useful Links</h2>
        <ul class="nav">
          <li><a href="https://github.com/eclipse/rdf4j/issues/">Report a Bug</a></li>
          <li><a href="/documentation/">Documentation</a></li>
          <li><a href="https://github.com/eclipse/rdf4j/blob/master/.github/CONTRIBUTING.md">How to Contribute</a></li>
        </ul>
      </section>
      <section class="col-sm-6 hidden-print" id="footer-other">
        <h2 class="section-title">Other</h2>
        <ul class="nav">
          <li><a href="https://www.eclipse.org/ide/">IDE and Tools</a></li>
          <li><a href="https://www.eclipse.org/projects">Community of Projects</a></li>
          <li><a href="https://www.eclipse.org/org/workinggroups/">Working Groups</a></li>
          <li><a href="https://www.eclipse.org/org/research/">Research@Eclipse</a></li>
          <li><a href="https://status.eclipse.org">Service Status</a></li>
        </ul>
      </section>
      <div class="col-sm-24 margin-top-20">
        <div class="row">
          <div id="copyright" class="col-md-16">
            <p id="copyright-text">Copyright &copy; Eclipse Foundation, Inc. All Rights Reserved.</p>
          </div>
          
        </div>
      </div>
      <a href="#" class="scrollup">Back to the top</a>
    </div>
  </div>
</footer>

<script src="https://www.eclipse.org/eclipse.org-common/themes/solstice/public/javascript/main.min.js"></script>

</body>
</html>

  
</body>
</html>

